---
phase: v1.4-02-query-key-unification
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - apps/admin/src/hooks/use-work-orders.ts
  - apps/admin/src/hooks/use-vendors.ts
  - apps/admin/src/hooks/use-invoices.ts
  - apps/admin/src/hooks/use-payments.ts
  - apps/admin/src/hooks/use-notifications.ts
  - apps/admin/src/hooks/use-notification-preferences.ts
  - apps/admin/src/hooks/use-activity-log.ts
  - apps/admin/src/hooks/use-service-requests.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Billing/work order hooks import keys from centralized registry"
    - "No local key factory definitions in migrated hooks"
    - "All queries use centralized keys"
  artifacts:
    - path: "apps/admin/src/hooks/use-work-orders.ts"
      provides: "Work order hooks using centralized keys"
      contains: "import { workOrderKeys } from '@/lib/queries'"
    - path: "apps/admin/src/hooks/use-invoices.ts"
      provides: "Invoice hooks using centralized keys"
      contains: "import { invoiceKeys } from '@/lib/queries'"
  key_links:
    - from: "apps/admin/src/hooks/use-*.ts"
      to: "apps/admin/src/lib/queries/keys.ts"
      via: "Import statement"
      pattern: "import.*Keys.*from.*@/lib/queries"
---

<objective>
Migrate billing, work order, notification, and service request hooks to use centralized query keys from `@/lib/queries`.

Purpose: Complete the migration of remaining hooks to centralized key registry.
Output: 8 hooks updated to import from centralized registry.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Plan 02-01 output:
@apps/admin/src/lib/queries/keys.ts (centralized keys)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate work order and vendor hooks</name>
  <files>
apps/admin/src/hooks/use-work-orders.ts
apps/admin/src/hooks/use-vendors.ts
  </files>
  <action>
**use-work-orders.ts changes:**
- Remove lines ~21-32 (workOrderKeys definition)
- Add import: `import { workOrderKeys, vendorKeys, recommendationKeys } from '@/lib/queries'`
- Update inline key usages:
  - `['recommendations']` -> `recommendationKeys.all`
  - `['vendors']` -> `vendorKeys.all`

**use-vendors.ts changes:**
- Remove lines ~23-35 (vendorKeys definition)
- Add import: `import { vendorKeys } from '@/lib/queries'`
  </action>
  <verify>
- `cd apps/admin && npx tsc --noEmit` compiles without errors
- No local key definitions remain in these files
  </verify>
  <done>
- Work order and vendor hooks migrated to centralized keys
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate billing hooks</name>
  <files>
apps/admin/src/hooks/use-invoices.ts
apps/admin/src/hooks/use-payments.ts
  </files>
  <action>
**use-invoices.ts changes:**
- Remove lines ~27-42 (invoiceKeys definition)
- Add import: `import { invoiceKeys, clientBillableKeys } from '@/lib/queries'`
- Note: The file has inline `['client-billable-items', clientId]` - use `invoiceKeys.clientBillableItems(clientId)` from centralized

**use-payments.ts changes:**
- Remove lines ~30-40 (paymentKeys definition)
- Add import: `import { paymentKeys, invoiceKeys } from '@/lib/queries'`
- Note: This file imports invoiceKeys from use-invoices.ts - change to import from '@/lib/queries'
  </action>
  <verify>
- `cd apps/admin && npx tsc --noEmit` compiles without errors
- No local key definitions remain in these files
  </verify>
  <done>
- Billing hooks migrated to centralized keys
- Cross-file imports now use centralized registry
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate notification and service request hooks</name>
  <files>
apps/admin/src/hooks/use-notifications.ts
apps/admin/src/hooks/use-notification-preferences.ts
apps/admin/src/hooks/use-activity-log.ts
apps/admin/src/hooks/use-service-requests.ts
  </files>
  <action>
**use-notifications.ts changes:**
- Remove lines ~17-28 (notificationKeys definition)
- Add import: `import { notificationKeys } from '@/lib/queries'`

**use-notification-preferences.ts changes:**
- Remove lines ~11-18 (preferencesKeys definition)
- Add import: `import { preferencesKeys } from '@/lib/queries'`

**use-activity-log.ts changes:**
- Remove lines ~14-24 (activityKeys definition)
- Add import: `import { activityKeys } from '@/lib/queries'`

**use-service-requests.ts changes:**
- Remove lines ~12-24 (serviceRequestKeys definition)
- Add import: `import { serviceRequestKeys, portalKeys } from '@/lib/queries'`
- Note: This file references portalKeys.dashboard() for invalidation
  </action>
  <verify>
- `cd apps/admin && npx tsc --noEmit` compiles without errors
- No local key definitions remain in these files
  </verify>
  <done>
- 4 notification/service request hooks migrated to centralized keys
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd apps/admin && npx tsc --noEmit`
2. Grep for local definitions should return empty for migrated files
3. Grep for centralized imports should show 8 more files importing from '@/lib/queries'
</verification>

<success_criteria>
- [ ] 8 hooks updated with centralized imports
- [ ] No local `xxxKeys = { ... }` definitions in migrated hooks
- [ ] All inline key strings replaced with factory calls
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/v1.4-02-query-key-unification/02-03-SUMMARY.md`
</output>
