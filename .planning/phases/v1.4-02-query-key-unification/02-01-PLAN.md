---
phase: v1.4-02-query-key-unification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/admin/src/lib/queries/keys.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All query key factories defined in single file"
    - "QueryKeys object exports typed factories for autocomplete"
    - "Keys use consistent naming convention (kebab-case for root)"
  artifacts:
    - path: "apps/admin/src/lib/queries/keys.ts"
      provides: "Centralized query key registry"
      exports: ["queryKeys", "QueryKeys"]
      min_lines: 150
  key_links:
    - from: "apps/admin/src/lib/queries/keys.ts"
      to: "All hook files"
      via: "Import and use queryKeys factories"
      pattern: "import.*queryKeys.*from.*queries/keys"
---

<objective>
Create centralized query key registry at `src/lib/queries/keys.ts` containing ALL query key factories.

Purpose: Eliminate scattered key definitions, enable type-safe autocomplete, and prepare for realtime sync alignment.
Output: Single source of truth for all React Query keys.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS-v1.4.md

Key reference files:
@apps/admin/src/lib/queries/config.ts (cache config from Phase 1)
@apps/admin/src/hooks/use-realtime-sync.ts (realtime sync hook to align with)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create centralized query key registry</name>
  <files>apps/admin/src/lib/queries/keys.ts</files>
  <action>
Create `apps/admin/src/lib/queries/keys.ts` with ALL query key factories consolidated from the 26+ hooks.

**Include these key factory objects:**

1. **Core entities:**
   - `clientKeys` - from use-clients.ts: all, lists, list(filters), detail(id)
   - `propertyKeys` - from use-properties.ts: all, lists, list(filters), detail(id)
   - `equipmentKeys` - from use-equipment.ts: all, property(id), detail(id)
   - `userKeys` - from use-users.ts: all, lists, list(filters), detail(id)

2. **Inspections:**
   - `inspectionKeys` - from use-inspections.ts: all, calendar(start, end), detail(id), property(id), inspectorWorkload
   - `inspectorKeys` - from use-inspectors.ts: all, lists, workload(start, end), schedule(id, date)
   - `inspectorScheduleKeys` - NEW: schedule(inspectorId, date), inspection(inspectionId), upcoming(inspectorId)
   - `inspectionTemplateKeys` - from use-inspection-templates.ts
   - `checklistKeys` - from use-checklist.ts

3. **Reports/Metrics:**
   - `reportKeys` - NEW: inspectionData(id)
   - `recommendationKeys` - NEW: all, inspection(id), property(id), detail(id)
   - `inspectionMetricKeys` - from use-inspection-metrics.ts
   - `workOrderMetricKeys` - from use-work-order-metrics.ts
   - `revenueMetricKeys` - from use-revenue-metrics.ts
   - `dashboardKeys` - from use-dashboard-overview.ts

4. **Work Orders/Vendors:**
   - `workOrderKeys` - from use-work-orders.ts: all, lists, list(filters), detail(id), property(id), vendor(id), counts
   - `vendorKeys` - from use-vendors.ts: all, lists, list(filters), detail(id), byTrade(category), search(query, category), complianceCounts

5. **Billing:**
   - `invoiceKeys` - from use-invoices.ts: all, lists, list(filters), detail(id), summary, clientBillableItems(id)
   - `paymentKeys` - from use-payments.ts: all, lists, list(filters), invoice(id), summary(period)

6. **Programs/Pricing:**
   - `programKeys` - from use-programs.ts: all, property(id)
   - `pricingKeys` - from use-pricing.ts: all, config

7. **Notifications/Activity:**
   - `notificationKeys` - from use-notifications.ts: all, list(filters), unreadCount, summary
   - `preferencesKeys` - from use-notification-preferences.ts: all, user(id)
   - `activityKeys` - from use-activity-log.ts: all, recent(limit), entity(type, id), list(filters)

8. **Portal:**
   - `portalKeys` - from use-portal-dashboard.ts: all, dashboard, properties, property(id), inspections(filters), inspection(id), requests(filters), request(id), invoices, invoice(id)

9. **Service Requests:**
   - `serviceRequestKeys` - from use-service-requests.ts: all, lists, list(filters), detail(id)
   - NOTE: Fix mismatch - use `service-requests` as root (not `serviceRequests`)

10. **Misc:**
    - `organizationKeys` - from use-organization.ts
    - `profileKeys` - from use-profile.ts
    - `assignmentKeys` - from use-property-assignments.ts
    - `photoKeys` - NEW: local(inspectionId, itemId)

**Key naming convention:**
- Root keys use kebab-case: `['clients']`, `['service-requests']`, `['work-orders']`
- Nested keys follow parent: `['clients', 'list', {...}]`

**Export:**
- Export each factory object individually for backwards compatibility during migration
- Export combined `queryKeys` object for convenience
- Export `QueryKeys` type for autocomplete

**Example structure:**
```typescript
export const clientKeys = {
  all: ['clients'] as const,
  lists: () => [...clientKeys.all, 'list'] as const,
  list: (filters: { search?: string; active?: boolean }) =>
    [...clientKeys.lists(), filters] as const,
  detail: (id: string) => [...clientKeys.all, 'detail', id] as const,
}

// Combined for convenience
export const queryKeys = {
  clients: clientKeys,
  properties: propertyKeys,
  // ... all others
} as const

export type QueryKeys = typeof queryKeys
```
  </action>
  <verify>
- File exists at apps/admin/src/lib/queries/keys.ts
- File exports all 26+ key factory objects
- File exports `queryKeys` combined object
- TypeScript compiles with no errors: `cd apps/admin && npx tsc --noEmit`
  </verify>
  <done>
- All query key factories consolidated in single file
- Consistent naming convention applied
- Types exported for autocomplete
  </done>
</task>

<task type="auto">
  <name>Task 2: Create barrel export for queries module</name>
  <files>apps/admin/src/lib/queries/index.ts</files>
  <action>
Create `apps/admin/src/lib/queries/index.ts` that re-exports everything from both config.ts and keys.ts.

```typescript
// Re-export cache configuration
export * from './config'

// Re-export query keys
export * from './keys'
```

This allows hooks to import from `@/lib/queries` instead of individual files.
  </action>
  <verify>
- File exists at apps/admin/src/lib/queries/index.ts
- Can import both config and keys from `@/lib/queries`
- TypeScript compiles with no errors
  </verify>
  <done>
- Clean barrel export enables `import { queryKeys, STALE_STANDARD } from '@/lib/queries'`
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd apps/admin && npx tsc --noEmit`
2. Verify exports: Check that keys.ts exports all required factories
3. Verify barrel: Check that index.ts re-exports both modules
</verification>

<success_criteria>
- [ ] `src/lib/queries/keys.ts` exists with all 26+ key factories
- [ ] Keys use consistent naming (kebab-case roots)
- [ ] `queryKeys` combined object exported
- [ ] `QueryKeys` type exported for autocomplete
- [ ] Barrel export at `src/lib/queries/index.ts`
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/v1.4-02-query-key-unification/02-01-SUMMARY.md`
</output>
