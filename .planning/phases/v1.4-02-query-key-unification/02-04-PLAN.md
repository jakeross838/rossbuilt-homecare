---
phase: v1.4-02-query-key-unification
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - apps/admin/src/hooks/use-portal-dashboard.ts
  - apps/admin/src/hooks/use-portal-inspections.ts
  - apps/admin/src/hooks/use-portal-invoices.ts
  - apps/admin/src/hooks/use-portal-property.ts
  - apps/admin/src/hooks/use-recommendations.ts
  - apps/admin/src/hooks/use-recommendation-response.ts
  - apps/admin/src/hooks/use-reports.ts
  - apps/admin/src/hooks/use-inspection-execution.ts
  - apps/admin/src/hooks/use-inspector-schedule.ts
  - apps/admin/src/hooks/use-dashboard-overview.ts
  - apps/admin/src/hooks/use-dashboard-activity.ts
  - apps/admin/src/hooks/use-inspection-metrics.ts
  - apps/admin/src/hooks/use-work-order-metrics.ts
  - apps/admin/src/hooks/use-revenue-metrics.ts
  - apps/admin/src/hooks/use-stripe.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Portal hooks import keys from centralized registry"
    - "Inspector/report hooks use centralized keys"
    - "Dashboard/metric hooks use centralized keys"
    - "No local key factory definitions in migrated hooks"
  artifacts:
    - path: "apps/admin/src/hooks/use-portal-dashboard.ts"
      provides: "Portal dashboard hooks using centralized keys"
      contains: "import { portalKeys } from '@/lib/queries'"
    - path: "apps/admin/src/hooks/use-inspector-schedule.ts"
      provides: "Inspector schedule hooks using centralized keys"
      contains: "import { inspectorScheduleKeys } from '@/lib/queries'"
  key_links:
    - from: "apps/admin/src/hooks/use-portal-*.ts"
      to: "apps/admin/src/lib/queries/keys.ts"
      via: "Import statement"
      pattern: "import.*portalKeys.*from.*@/lib/queries"
---

<objective>
Migrate portal, inspector, report, and dashboard hooks to use centralized query keys from `@/lib/queries`.

Purpose: Complete final batch of hook migrations including portal, metrics, and inspector hooks.
Output: 15 hooks updated to import from centralized registry.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Plan 02-01 output:
@apps/admin/src/lib/queries/keys.ts (centralized keys)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate portal hooks</name>
  <files>
apps/admin/src/hooks/use-portal-dashboard.ts
apps/admin/src/hooks/use-portal-inspections.ts
apps/admin/src/hooks/use-portal-invoices.ts
apps/admin/src/hooks/use-portal-property.ts
apps/admin/src/hooks/use-recommendation-response.ts
  </files>
  <action>
**use-portal-dashboard.ts changes:**
- Remove lines ~8-21 (portalKeys definition)
- Add import: `import { portalKeys } from '@/lib/queries'`

**use-portal-inspections.ts changes:**
- Add import at top: `import { portalKeys } from '@/lib/queries'`
- Note: This file imports portalKeys from use-portal-dashboard.ts - change to import from '@/lib/queries'

**use-portal-invoices.ts changes:**
- Add import at top: `import { portalKeys } from '@/lib/queries'`
- Note: This file imports portalKeys from use-portal-dashboard.ts - change to import from '@/lib/queries'

**use-portal-property.ts changes:**
- Add import at top: `import { portalKeys } from '@/lib/queries'`
- Note: This file imports portalKeys from use-portal-dashboard.ts - change to import from '@/lib/queries'

**use-recommendation-response.ts changes:**
- Add import at top: `import { portalKeys } from '@/lib/queries'`
- Note: This file imports portalKeys from use-portal-dashboard.ts - change to import from '@/lib/queries'
  </action>
  <verify>
- `cd apps/admin && npx tsc --noEmit` compiles without errors
- No local key definitions remain in these files
- No imports of portalKeys from use-portal-dashboard.ts remain
  </verify>
  <done>
- 5 portal hooks migrated to centralized keys
- Cross-file imports cleaned up
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate inspector and report hooks</name>
  <files>
apps/admin/src/hooks/use-inspector-schedule.ts
apps/admin/src/hooks/use-inspection-execution.ts
apps/admin/src/hooks/use-recommendations.ts
apps/admin/src/hooks/use-reports.ts
  </files>
  <action>
**use-inspector-schedule.ts changes:**
- This file uses inline keys like `['inspector-schedule', inspectorId, date]`
- Add import: `import { inspectorScheduleKeys } from '@/lib/queries'`
- Replace inline keys:
  - `['inspector-schedule', inspectorId, date]` -> `inspectorScheduleKeys.schedule(inspectorId, date)`
  - `['inspector-inspection', inspectionId]` -> `inspectorScheduleKeys.inspection(inspectionId)`
  - `['inspector-upcoming', inspectorId]` -> `inspectorScheduleKeys.upcoming(inspectorId)`

**use-inspection-execution.ts changes:**
- Add import: `import { inspectorScheduleKeys, recommendationKeys, inspectionKeys } from '@/lib/queries'`
- Replace inline keys:
  - `['inspector-inspection', inspectionId]` -> `inspectorScheduleKeys.inspection(inspectionId)`
  - `['inspector-schedule']` -> `inspectorScheduleKeys.all`
  - `['calendar-inspections']` -> `inspectionKeys.calendarAll()`
  - `['inspector-upcoming']` -> `inspectorScheduleKeys.upcomingAll()`
  - `['recommendations']` -> `recommendationKeys.all`

**use-recommendations.ts changes:**
- Add import: `import { recommendationKeys } from '@/lib/queries'`
- Replace inline keys:
  - `['recommendations', 'inspection', inspectionId]` -> `recommendationKeys.inspection(inspectionId)`
  - `['recommendations', 'property', propertyId]` -> `recommendationKeys.property(propertyId)`
  - `['recommendation', id]` -> `recommendationKeys.detail(id)`
  - `['recommendations']` -> `recommendationKeys.all`

**use-reports.ts changes:**
- Add import: `import { reportKeys, inspectionKeys } from '@/lib/queries'`
- Replace inline keys:
  - `['inspection-report-data', inspectionId]` -> `reportKeys.inspectionData(inspectionId)`
  - `['inspections']` -> `inspectionKeys.all`
  </action>
  <verify>
- `cd apps/admin && npx tsc --noEmit` compiles without errors
- No inline query key arrays remain in these files
  </verify>
  <done>
- 4 inspector/report hooks migrated to centralized keys
- All inline key strings replaced with factory calls
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate dashboard and metrics hooks</name>
  <files>
apps/admin/src/hooks/use-dashboard-overview.ts
apps/admin/src/hooks/use-dashboard-activity.ts
apps/admin/src/hooks/use-inspection-metrics.ts
apps/admin/src/hooks/use-work-order-metrics.ts
apps/admin/src/hooks/use-revenue-metrics.ts
apps/admin/src/hooks/use-stripe.ts
  </files>
  <action>
**use-dashboard-overview.ts changes:**
- Remove lines ~15-24 (dashboardKeys definition)
- Add import: `import { dashboardKeys } from '@/lib/queries'`

**use-dashboard-activity.ts changes:**
- This file imports dashboardKeys from use-dashboard-overview.ts
- Change import to: `import { dashboardKeys } from '@/lib/queries'`

**use-inspection-metrics.ts changes:**
- Remove lines ~23-32 (inspectionMetricKeys definition)
- Add import: `import { inspectionMetricKeys } from '@/lib/queries'`

**use-work-order-metrics.ts changes:**
- Remove lines ~22-32 (workOrderMetricKeys definition)
- Add import: `import { workOrderMetricKeys } from '@/lib/queries'`

**use-revenue-metrics.ts changes:**
- Remove lines ~22-32 (revenueMetricKeys definition)
- Add import: `import { revenueMetricKeys } from '@/lib/queries'`

**use-stripe.ts changes:**
- This file imports invoiceKeys from use-invoices.ts
- Change import to: `import { invoiceKeys } from '@/lib/queries'`
  </action>
  <verify>
- `cd apps/admin && npx tsc --noEmit` compiles without errors
- No local key definitions remain in these files
- No cross-hook imports of key factories remain
  </verify>
  <done>
- 6 dashboard/metrics/stripe hooks migrated to centralized keys
- All cross-hook key imports cleaned up
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd apps/admin && npx tsc --noEmit`
2. Grep for local definitions: Should find no `export const.*Keys = {` in migrated hooks
3. Grep for cross-hook imports: Should find no `from './use-portal-dashboard'` or similar key imports
4. Build verification: `npm run build`
</verification>

<success_criteria>
- [ ] 15 hooks updated with centralized imports
- [ ] No local `xxxKeys = { ... }` definitions in migrated hooks
- [ ] No cross-hook key factory imports (all from '@/lib/queries')
- [ ] All inline key arrays replaced with factory calls
- [ ] TypeScript compiles without errors
- [ ] App builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/v1.4-02-query-key-unification/02-04-SUMMARY.md`
</output>
