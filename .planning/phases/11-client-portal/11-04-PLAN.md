# Plan 11-04: Client Portal UI Components

## Objective

Create the UI components for the client portal including layout, navigation, property cards, inspection summaries, service request forms, and recommendation approval interfaces. These components follow the Ross Built brand aesthetic and are optimized for a client-facing experience.

## Dependencies

- 11-01: Portal types, constants, and helpers
- 11-02: Portal data hooks
- 11-03: Service request and recommendation hooks
- Existing shadcn/ui components from Phase 2

## Constraints

- Must use existing shadcn/ui component library
- Follow Ross Built brand aesthetic (clean, minimalist, professional)
- Mobile-responsive design (many clients will use phones)
- Accessible UI following existing patterns

## Tasks

### Task 1: Portal Layout Components

Create `apps/admin/src/components/portal/portal-layout.tsx`:

```typescript
import { Outlet, Link, useLocation, useNavigate } from 'react-router-dom'
import {
  LayoutDashboard,
  Home,
  ClipboardCheck,
  MessageSquare,
  Receipt,
  LogOut,
  Menu,
  X,
  User,
} from 'lucide-react'
import { useState } from 'react'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { useAuthStore } from '@/stores/auth-store'
import { usePortalAuth } from '@/hooks/use-portal-auth'

const navItems = [
  { label: 'Dashboard', href: '/portal', icon: LayoutDashboard },
  { label: 'Properties', href: '/portal/properties', icon: Home },
  { label: 'Inspections', href: '/portal/inspections', icon: ClipboardCheck },
  { label: 'Requests', href: '/portal/requests', icon: MessageSquare },
  { label: 'Invoices', href: '/portal/invoices', icon: Receipt },
]

export function PortalLayout() {
  const location = useLocation()
  const navigate = useNavigate()
  const { profile } = usePortalAuth()
  const signOut = useAuthStore((state) => state.signOut)
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false)

  const handleSignOut = async () => {
    await signOut()
    navigate('/portal/login')
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white border-b border-gray-200 sticky top-0 z-40">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center h-16">
            {/* Logo */}
            <Link to="/portal" className="flex items-center gap-2">
              <span className="text-xl font-semibold text-gray-900">
                Ross Built
              </span>
              <span className="text-sm text-gray-500">Client Portal</span>
            </Link>

            {/* Desktop Nav */}
            <nav className="hidden md:flex items-center gap-1">
              {navItems.map((item) => {
                const isActive = location.pathname === item.href ||
                  (item.href !== '/portal' && location.pathname.startsWith(item.href))
                return (
                  <Link
                    key={item.href}
                    to={item.href}
                    className={cn(
                      'flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors',
                      isActive
                        ? 'bg-gray-100 text-gray-900'
                        : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                    )}
                  >
                    <item.icon className="h-4 w-4" />
                    {item.label}
                  </Link>
                )
              })}
            </nav>

            {/* User Menu */}
            <div className="flex items-center gap-4">
              <div className="hidden sm:flex items-center gap-2 text-sm text-gray-600">
                <User className="h-4 w-4" />
                <span>
                  {profile?.first_name} {profile?.last_name}
                </span>
              </div>
              <Button
                variant="ghost"
                size="sm"
                onClick={handleSignOut}
                className="hidden sm:flex"
              >
                <LogOut className="h-4 w-4 mr-2" />
                Sign Out
              </Button>

              {/* Mobile menu button */}
              <Button
                variant="ghost"
                size="sm"
                className="md:hidden"
                onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
              >
                {mobileMenuOpen ? (
                  <X className="h-5 w-5" />
                ) : (
                  <Menu className="h-5 w-5" />
                )}
              </Button>
            </div>
          </div>
        </div>

        {/* Mobile Nav */}
        {mobileMenuOpen && (
          <div className="md:hidden border-t border-gray-200 bg-white">
            <nav className="px-4 py-3 space-y-1">
              {navItems.map((item) => {
                const isActive = location.pathname === item.href ||
                  (item.href !== '/portal' && location.pathname.startsWith(item.href))
                return (
                  <Link
                    key={item.href}
                    to={item.href}
                    onClick={() => setMobileMenuOpen(false)}
                    className={cn(
                      'flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium',
                      isActive
                        ? 'bg-gray-100 text-gray-900'
                        : 'text-gray-600'
                    )}
                  >
                    <item.icon className="h-5 w-5" />
                    {item.label}
                  </Link>
                )
              })}
              <button
                onClick={handleSignOut}
                className="flex items-center gap-3 px-3 py-2 w-full text-left rounded-md text-sm font-medium text-gray-600"
              >
                <LogOut className="h-5 w-5" />
                Sign Out
              </button>
            </nav>
          </div>
        )}
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <Outlet />
      </main>

      {/* Footer */}
      <footer className="bg-white border-t border-gray-200 py-6 mt-auto">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <p className="text-center text-sm text-gray-500">
            &copy; {new Date().getFullYear()} Ross Built. All rights reserved.
          </p>
        </div>
      </footer>
    </div>
  )
}
```

### Task 2: Dashboard Summary Cards

Create `apps/admin/src/components/portal/dashboard-summary.tsx`:

```typescript
import { Home, Calendar, MessageSquare, CheckCircle, DollarSign } from 'lucide-react'
import { Card, CardContent } from '@/components/ui/card'
import { Skeleton } from '@/components/ui/skeleton'
import { formatCurrency } from '@/lib/helpers/billing'
import type { PortalDashboardSummary } from '@/lib/types/portal'

interface DashboardSummaryProps {
  data: PortalDashboardSummary | undefined
  isLoading: boolean
}

export function DashboardSummary({ data, isLoading }: DashboardSummaryProps) {
  const items = [
    {
      label: 'Properties',
      value: data?.properties_count ?? 0,
      icon: Home,
      color: 'text-blue-600',
      bgColor: 'bg-blue-50',
    },
    {
      label: 'Upcoming Inspections',
      value: data?.upcoming_inspections ?? 0,
      icon: Calendar,
      color: 'text-green-600',
      bgColor: 'bg-green-50',
    },
    {
      label: 'Open Requests',
      value: data?.open_service_requests ?? 0,
      icon: MessageSquare,
      color: 'text-orange-600',
      bgColor: 'bg-orange-50',
    },
    {
      label: 'Pending Approvals',
      value: data?.pending_approvals ?? 0,
      icon: CheckCircle,
      color: 'text-purple-600',
      bgColor: 'bg-purple-50',
    },
    {
      label: 'Outstanding Balance',
      value: formatCurrency(data?.outstanding_balance ?? 0),
      icon: DollarSign,
      color: 'text-gray-600',
      bgColor: 'bg-gray-50',
      isBalance: true,
    },
  ]

  if (isLoading) {
    return (
      <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
        {items.map((_, i) => (
          <Card key={i}>
            <CardContent className="pt-6">
              <Skeleton className="h-10 w-10 rounded-full mb-3" />
              <Skeleton className="h-6 w-16 mb-1" />
              <Skeleton className="h-4 w-24" />
            </CardContent>
          </Card>
        ))}
      </div>
    )
  }

  return (
    <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
      {items.map((item) => (
        <Card key={item.label}>
          <CardContent className="pt-6">
            <div className={`inline-flex p-2 rounded-full ${item.bgColor} mb-3`}>
              <item.icon className={`h-5 w-5 ${item.color}`} />
            </div>
            <p className="text-2xl font-semibold text-gray-900">
              {item.value}
            </p>
            <p className="text-sm text-gray-500">{item.label}</p>
          </CardContent>
        </Card>
      ))}
    </div>
  )
}
```

### Task 3: Property Card Component

Create `apps/admin/src/components/portal/property-card.tsx`:

```typescript
import { Link } from 'react-router-dom'
import { Home, Wrench, AlertCircle, Calendar, ChevronRight } from 'lucide-react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { cn } from '@/lib/utils'
import {
  formatCondition,
  formatInspectionTier,
  formatFrequency,
  getPropertyHealth,
  formatRelativeDate,
} from '@/lib/helpers/portal'
import type { PortalProperty } from '@/lib/types/portal'

interface PropertyCardProps {
  property: PortalProperty
}

export function PropertyCard({ property }: PropertyCardProps) {
  const health = getPropertyHealth(property)
  const condition = formatCondition(property.overall_condition)

  return (
    <Link to={`/portal/properties/${property.id}`}>
      <Card className="hover:shadow-md transition-shadow cursor-pointer">
        <CardHeader className="pb-3">
          <div className="flex items-start justify-between">
            <div className="flex items-start gap-3">
              {property.primary_photo_url ? (
                <img
                  src={property.primary_photo_url}
                  alt={property.name}
                  className="h-12 w-12 rounded-lg object-cover"
                />
              ) : (
                <div className="h-12 w-12 rounded-lg bg-gray-100 flex items-center justify-center">
                  <Home className="h-6 w-6 text-gray-400" />
                </div>
              )}
              <div>
                <CardTitle className="text-base">{property.name}</CardTitle>
                <p className="text-sm text-gray-500">
                  {property.address_line1}, {property.city}
                </p>
              </div>
            </div>
            <ChevronRight className="h-5 w-5 text-gray-400" />
          </div>
        </CardHeader>

        <CardContent className="pt-0">
          {/* Program Info */}
          {property.program && (
            <div className="flex flex-wrap gap-2 mb-4">
              <Badge variant="outline">
                {formatInspectionTier(property.program.tier)}
              </Badge>
              <Badge variant="outline">
                {formatFrequency(property.program.frequency)}
              </Badge>
            </div>
          )}

          {/* Health & Condition */}
          <div className="flex items-center justify-between text-sm mb-4">
            <span className={cn('font-medium', health.color)}>{health.label}</span>
            <span className={cn(condition.color)}>{condition.label}</span>
          </div>

          {/* Stats Row */}
          <div className="flex items-center gap-4 text-sm text-gray-500">
            {property.open_work_order_count > 0 && (
              <div className="flex items-center gap-1">
                <Wrench className="h-4 w-4 text-yellow-500" />
                <span>{property.open_work_order_count} work orders</span>
              </div>
            )}
            {property.pending_recommendation_count > 0 && (
              <div className="flex items-center gap-1">
                <AlertCircle className="h-4 w-4 text-orange-500" />
                <span>{property.pending_recommendation_count} pending</span>
              </div>
            )}
          </div>

          {/* Next Inspection */}
          {property.program?.next_inspection_date && (
            <div className="flex items-center gap-1 text-sm text-gray-500 mt-3 pt-3 border-t">
              <Calendar className="h-4 w-4" />
              <span>
                Next inspection: {formatRelativeDate(property.program.next_inspection_date)}
              </span>
            </div>
          )}
        </CardContent>
      </Card>
    </Link>
  )
}
```

### Task 4: Service Request Form

Create `apps/admin/src/components/portal/service-request-form.tsx`:

```typescript
import { useState } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { Loader2, Upload, X, AlertTriangle } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from '@/components/ui/dialog'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { SERVICE_REQUEST_TYPES, PRIORITY_DISPLAY } from '@/lib/constants/portal'
import {
  createServiceRequestSchema,
  type CreateServiceRequestInput,
} from '@/lib/validations/service-request'
import { useCreateServiceRequest, useUploadServiceRequestPhoto } from '@/hooks/use-service-requests'
import { usePortalProperties } from '@/hooks/use-portal-dashboard'
import { useToast } from '@/hooks/use-toast'
import type { Resolver } from 'react-hook-form'

interface ServiceRequestFormProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  defaultPropertyId?: string
}

export function ServiceRequestForm({
  open,
  onOpenChange,
  defaultPropertyId,
}: ServiceRequestFormProps) {
  const { toast } = useToast()
  const { data: properties } = usePortalProperties()
  const createRequest = useCreateServiceRequest()
  const uploadPhoto = useUploadServiceRequestPhoto()
  const [photos, setPhotos] = useState<string[]>([])
  const [uploading, setUploading] = useState(false)

  const {
    register,
    handleSubmit,
    setValue,
    watch,
    reset,
    formState: { errors, isSubmitting },
  } = useForm<CreateServiceRequestInput>({
    resolver: zodResolver(createServiceRequestSchema) as Resolver<CreateServiceRequestInput>,
    defaultValues: {
      property_id: defaultPropertyId || '',
      request_type: 'maintenance',
      priority: 'medium',
      title: '',
      description: '',
      photos: [],
    },
  })

  const selectedType = watch('request_type')

  const handlePhotoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = e.target.files
    if (!files?.length) return

    setUploading(true)
    try {
      const uploadPromises = Array.from(files).map((file) =>
        uploadPhoto.mutateAsync({ file })
      )
      const urls = await Promise.all(uploadPromises)
      const newPhotos = [...photos, ...urls]
      setPhotos(newPhotos)
      setValue('photos', newPhotos)
    } catch (error) {
      toast({
        title: 'Upload failed',
        description: 'Failed to upload photos. Please try again.',
        variant: 'destructive',
      })
    } finally {
      setUploading(false)
    }
  }

  const removePhoto = (index: number) => {
    const newPhotos = photos.filter((_, i) => i !== index)
    setPhotos(newPhotos)
    setValue('photos', newPhotos)
  }

  const onSubmit = async (data: CreateServiceRequestInput) => {
    try {
      await createRequest.mutateAsync({
        ...data,
        photos,
      })
      toast({
        title: 'Request submitted',
        description: 'We\'ll get back to you as soon as possible.',
      })
      reset()
      setPhotos([])
      onOpenChange(false)
    } catch (error) {
      toast({
        title: 'Error',
        description: 'Failed to submit request. Please try again.',
        variant: 'destructive',
      })
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-lg max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>Submit Service Request</DialogTitle>
          <DialogDescription>
            Describe what you need and we'll get back to you promptly.
          </DialogDescription>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          {/* Property Selection */}
          <div className="space-y-2">
            <Label htmlFor="property_id">Property *</Label>
            <Select
              value={watch('property_id')}
              onValueChange={(value) => setValue('property_id', value)}
            >
              <SelectTrigger>
                <SelectValue placeholder="Select a property" />
              </SelectTrigger>
              <SelectContent>
                {properties?.map((prop) => (
                  <SelectItem key={prop.id} value={prop.id}>
                    {prop.name} - {prop.address_line1}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
            {errors.property_id && (
              <p className="text-sm text-red-600">{errors.property_id.message}</p>
            )}
          </div>

          {/* Request Type */}
          <div className="space-y-2">
            <Label htmlFor="request_type">Request Type *</Label>
            <Select
              value={selectedType}
              onValueChange={(value) => setValue('request_type', value as typeof selectedType)}
            >
              <SelectTrigger>
                <SelectValue placeholder="What kind of request?" />
              </SelectTrigger>
              <SelectContent>
                {SERVICE_REQUEST_TYPES.map((type) => (
                  <SelectItem key={type.value} value={type.value}>
                    <div>
                      <p className="font-medium">{type.label}</p>
                      <p className="text-xs text-gray-500">{type.description}</p>
                    </div>
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Emergency Warning */}
          {selectedType === 'emergency' && (
            <Alert variant="destructive">
              <AlertTriangle className="h-4 w-4" />
              <AlertDescription>
                For true emergencies (flooding, fire, security breach), please also call us
                directly at <strong>(555) 123-4567</strong>.
              </AlertDescription>
            </Alert>
          )}

          {/* Priority */}
          <div className="space-y-2">
            <Label htmlFor="priority">Priority</Label>
            <Select
              value={watch('priority')}
              onValueChange={(value) => setValue('priority', value as 'low' | 'medium' | 'high' | 'urgent')}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {Object.entries(PRIORITY_DISPLAY).map(([value, config]) => (
                  <SelectItem key={value} value={value}>
                    {config.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Title */}
          <div className="space-y-2">
            <Label htmlFor="title">Subject *</Label>
            <Input
              id="title"
              placeholder="Brief summary of your request"
              {...register('title')}
            />
            {errors.title && (
              <p className="text-sm text-red-600">{errors.title.message}</p>
            )}
          </div>

          {/* Description */}
          <div className="space-y-2">
            <Label htmlFor="description">Details *</Label>
            <Textarea
              id="description"
              placeholder="Please describe what you need in detail..."
              rows={4}
              {...register('description')}
            />
            {errors.description && (
              <p className="text-sm text-red-600">{errors.description.message}</p>
            )}
          </div>

          {/* Photo Upload */}
          <div className="space-y-2">
            <Label>Photos (optional)</Label>
            <div className="flex flex-wrap gap-2">
              {photos.map((url, index) => (
                <div key={index} className="relative">
                  <img
                    src={url}
                    alt={`Upload ${index + 1}`}
                    className="h-20 w-20 object-cover rounded-lg"
                  />
                  <button
                    type="button"
                    onClick={() => removePhoto(index)}
                    className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1"
                  >
                    <X className="h-3 w-3" />
                  </button>
                </div>
              ))}
              {photos.length < 10 && (
                <label className="h-20 w-20 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer hover:border-gray-400">
                  {uploading ? (
                    <Loader2 className="h-6 w-6 animate-spin text-gray-400" />
                  ) : (
                    <Upload className="h-6 w-6 text-gray-400" />
                  )}
                  <input
                    type="file"
                    accept="image/*"
                    multiple
                    className="hidden"
                    onChange={handlePhotoUpload}
                    disabled={uploading}
                  />
                </label>
              )}
            </div>
            <p className="text-xs text-gray-500">
              Add photos to help us understand the issue
            </p>
          </div>

          {/* Submit */}
          <div className="flex justify-end gap-3 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
            >
              Cancel
            </Button>
            <Button type="submit" disabled={isSubmitting}>
              {isSubmitting && <Loader2 className="h-4 w-4 mr-2 animate-spin" />}
              Submit Request
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  )
}
```

### Task 5: Recommendation Approval Card

Create `apps/admin/src/components/portal/recommendation-card.tsx`:

```typescript
import { useState } from 'react'
import { Check, X, Loader2, AlertCircle } from 'lucide-react'
import { Card, CardContent, CardHeader, CardTitle, CardFooter } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Textarea } from '@/components/ui/textarea'
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog'
import { formatCurrency } from '@/lib/helpers/billing'
import { getPriorityStyles, formatRelativeDate } from '@/lib/helpers/portal'
import {
  useApproveRecommendation,
  useDeclineRecommendation,
} from '@/hooks/use-recommendation-response'
import { useToast } from '@/hooks/use-toast'
import type { PortalRecommendation } from '@/lib/types/portal'

interface RecommendationCardProps {
  recommendation: PortalRecommendation
}

export function RecommendationCard({ recommendation }: RecommendationCardProps) {
  const { toast } = useToast()
  const approve = useApproveRecommendation()
  const decline = useDeclineRecommendation()
  const [showDeclineDialog, setShowDeclineDialog] = useState(false)
  const [declineNotes, setDeclineNotes] = useState('')

  const priority = getPriorityStyles(recommendation.priority)

  const handleApprove = async () => {
    try {
      await approve.mutateAsync(recommendation.id)
      toast({
        title: 'Recommendation approved',
        description: 'We\'ll schedule this work and keep you updated.',
      })
    } catch (error) {
      toast({
        title: 'Error',
        description: 'Failed to approve recommendation.',
        variant: 'destructive',
      })
    }
  }

  const handleDecline = async () => {
    try {
      await decline.mutateAsync(recommendation.id, declineNotes)
      toast({
        title: 'Recommendation declined',
        description: 'We\'ve noted your decision.',
      })
      setShowDeclineDialog(false)
    } catch (error) {
      toast({
        title: 'Error',
        description: 'Failed to decline recommendation.',
        variant: 'destructive',
      })
    }
  }

  const isLoading = approve.isPending || decline.isPending

  return (
    <>
      <Card>
        <CardHeader className="pb-3">
          <div className="flex items-start justify-between gap-4">
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-1">
                <Badge className={priority.color}>{priority.label}</Badge>
                <span className="text-sm text-gray-500">{recommendation.category}</span>
              </div>
              <CardTitle className="text-base">{recommendation.title}</CardTitle>
            </div>
            {recommendation.estimated_cost && (
              <div className="text-right">
                <p className="text-sm text-gray-500">Est. Cost</p>
                <p className="text-lg font-semibold">
                  {formatCurrency(recommendation.estimated_cost)}
                </p>
              </div>
            )}
          </div>
        </CardHeader>

        <CardContent className="pb-3">
          <p className="text-sm text-gray-600">{recommendation.description}</p>

          {recommendation.inspection && (
            <p className="text-xs text-gray-400 mt-3">
              From inspection on {formatRelativeDate(recommendation.inspection.inspection_date)}
            </p>
          )}
        </CardContent>

        <CardFooter className="flex justify-end gap-2 pt-3 border-t">
          <Button
            variant="outline"
            size="sm"
            onClick={() => setShowDeclineDialog(true)}
            disabled={isLoading}
          >
            <X className="h-4 w-4 mr-1" />
            Decline
          </Button>
          <Button
            size="sm"
            onClick={handleApprove}
            disabled={isLoading}
          >
            {isLoading ? (
              <Loader2 className="h-4 w-4 mr-1 animate-spin" />
            ) : (
              <Check className="h-4 w-4 mr-1" />
            )}
            Approve
          </Button>
        </CardFooter>
      </Card>

      <AlertDialog open={showDeclineDialog} onOpenChange={setShowDeclineDialog}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Decline Recommendation?</AlertDialogTitle>
            <AlertDialogDescription>
              You can optionally provide a reason for declining. This helps us understand
              your preferences for future recommendations.
            </AlertDialogDescription>
          </AlertDialogHeader>

          <Textarea
            placeholder="Reason for declining (optional)"
            value={declineNotes}
            onChange={(e) => setDeclineNotes(e.target.value)}
            rows={3}
          />

          <AlertDialogFooter>
            <AlertDialogCancel>Cancel</AlertDialogCancel>
            <AlertDialogAction onClick={handleDecline} disabled={decline.isPending}>
              {decline.isPending && <Loader2 className="h-4 w-4 mr-2 animate-spin" />}
              Decline
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  )
}
```

### Task 6: Inspection Summary Card

Create `apps/admin/src/components/portal/inspection-card.tsx`:

```typescript
import { Link } from 'react-router-dom'
import {
  Calendar,
  User,
  CheckCircle,
  AlertCircle,
  AlertTriangle,
  FileText,
  ChevronRight,
} from 'lucide-react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { cn } from '@/lib/utils'
import {
  formatCondition,
  formatInspectionTier,
  formatRelativeDate,
} from '@/lib/helpers/portal'
import type { PortalInspection } from '@/lib/types/portal'

interface InspectionCardProps {
  inspection: PortalInspection
  showProperty?: boolean
}

export function InspectionCard({ inspection, showProperty }: InspectionCardProps) {
  const condition = formatCondition(inspection.overall_condition)
  const isCompleted = inspection.status === 'completed'
  const isScheduled = inspection.status === 'scheduled'

  return (
    <Card>
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div>
            <div className="flex items-center gap-2 mb-1">
              <Badge variant={isCompleted ? 'default' : 'secondary'}>
                {isCompleted ? 'Completed' : isScheduled ? 'Scheduled' : 'In Progress'}
              </Badge>
              <Badge variant="outline">
                {formatInspectionTier(inspection.inspection_type)}
              </Badge>
            </div>
            <div className="flex items-center gap-2 text-sm text-gray-500 mt-1">
              <Calendar className="h-4 w-4" />
              <span>{formatRelativeDate(inspection.inspection_date)}</span>
            </div>
          </div>
          {isCompleted && inspection.report_url && (
            <Button variant="outline" size="sm" asChild>
              <a href={inspection.report_url} target="_blank" rel="noopener noreferrer">
                <FileText className="h-4 w-4 mr-1" />
                View Report
              </a>
            </Button>
          )}
        </div>
      </CardHeader>

      <CardContent className="pt-0">
        {/* Condition & Inspector */}
        {isCompleted && (
          <div className="flex items-center justify-between text-sm mb-4">
            <span className={cn('font-medium', condition.color)}>
              {condition.label}
            </span>
            {inspection.inspector && (
              <span className="text-gray-500 flex items-center gap-1">
                <User className="h-4 w-4" />
                {inspection.inspector.first_name} {inspection.inspector.last_name}
              </span>
            )}
          </div>
        )}

        {/* Findings Summary */}
        {isCompleted && inspection.findings_summary.total > 0 && (
          <div className="flex items-center gap-4 text-sm">
            <div className="flex items-center gap-1 text-green-600">
              <CheckCircle className="h-4 w-4" />
              <span>{inspection.findings_summary.passed} passed</span>
            </div>
            {inspection.findings_summary.needs_attention > 0 && (
              <div className="flex items-center gap-1 text-yellow-600">
                <AlertCircle className="h-4 w-4" />
                <span>{inspection.findings_summary.needs_attention} attention</span>
              </div>
            )}
            {inspection.findings_summary.urgent > 0 && (
              <div className="flex items-center gap-1 text-red-600">
                <AlertTriangle className="h-4 w-4" />
                <span>{inspection.findings_summary.urgent} urgent</span>
              </div>
            )}
          </div>
        )}

        {/* Summary Text */}
        {inspection.summary && (
          <p className="text-sm text-gray-600 mt-3 line-clamp-2">
            {inspection.summary}
          </p>
        )}

        {/* View Details Link */}
        <Link
          to={`/portal/inspections/${inspection.id}`}
          className="flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 mt-3"
        >
          View details
          <ChevronRight className="h-4 w-4" />
        </Link>
      </CardContent>
    </Card>
  )
}
```

### Task 7: Invoice Card

Create `apps/admin/src/components/portal/invoice-card.tsx`:

```typescript
import { ExternalLink, CreditCard, Check } from 'lucide-react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { formatCurrency } from '@/lib/helpers/billing'
import { INVOICE_STATUS_CONFIG } from '@/lib/constants/billing'
import type { PortalInvoice } from '@/lib/types/portal'

interface InvoiceCardProps {
  invoice: PortalInvoice
}

export function InvoiceCard({ invoice }: InvoiceCardProps) {
  const statusConfig = INVOICE_STATUS_CONFIG[invoice.status]
  const isPaid = invoice.status === 'paid'
  const canPay = ['sent', 'viewed', 'partial', 'overdue'].includes(invoice.status)

  return (
    <Card>
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div>
            <p className="text-sm text-gray-500">Invoice #{invoice.invoice_number}</p>
            <CardTitle className="text-lg mt-1">
              {formatCurrency(invoice.total)}
            </CardTitle>
          </div>
          <Badge className={statusConfig?.badgeVariant === 'success' ? 'bg-green-100 text-green-800' :
                          statusConfig?.badgeVariant === 'destructive' ? 'bg-red-100 text-red-800' :
                          'bg-gray-100 text-gray-800'}>
            {statusConfig?.label || invoice.status}
          </Badge>
        </div>
      </CardHeader>

      <CardContent className="pt-0">
        {/* Dates */}
        <div className="flex items-center justify-between text-sm text-gray-500 mb-4">
          <span>Issued: {new Date(invoice.issue_date).toLocaleDateString()}</span>
          <span>Due: {new Date(invoice.due_date).toLocaleDateString()}</span>
        </div>

        {/* Balance Due */}
        {!isPaid && invoice.balance_due > 0 && (
          <div className="flex items-center justify-between py-2 border-t">
            <span className="font-medium">Balance Due</span>
            <span className="text-lg font-semibold">
              {formatCurrency(invoice.balance_due)}
            </span>
          </div>
        )}

        {/* Line Items Preview */}
        {invoice.line_items.length > 0 && (
          <div className="border-t pt-3 mt-3">
            <p className="text-sm text-gray-500 mb-2">Items:</p>
            <ul className="text-sm space-y-1">
              {invoice.line_items.slice(0, 3).map((item, i) => (
                <li key={i} className="flex justify-between">
                  <span className="text-gray-600">{item.description}</span>
                  <span>{formatCurrency(item.amount)}</span>
                </li>
              ))}
              {invoice.line_items.length > 3 && (
                <li className="text-gray-400">
                  +{invoice.line_items.length - 3} more items
                </li>
              )}
            </ul>
          </div>
        )}

        {/* Pay Button */}
        {canPay && invoice.stripe_payment_url && (
          <Button className="w-full mt-4" asChild>
            <a href={invoice.stripe_payment_url} target="_blank" rel="noopener noreferrer">
              <CreditCard className="h-4 w-4 mr-2" />
              Pay Now
              <ExternalLink className="h-4 w-4 ml-2" />
            </a>
          </Button>
        )}

        {isPaid && (
          <div className="flex items-center justify-center gap-2 text-green-600 mt-4 py-2 bg-green-50 rounded-md">
            <Check className="h-5 w-5" />
            <span className="font-medium">Paid in Full</span>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

## Verification

After completing all tasks, verify:

1. **Types compile**: `cd apps/admin && npx tsc --noEmit`
2. **Files exist**:
   - `apps/admin/src/components/portal/portal-layout.tsx`
   - `apps/admin/src/components/portal/dashboard-summary.tsx`
   - `apps/admin/src/components/portal/property-card.tsx`
   - `apps/admin/src/components/portal/service-request-form.tsx`
   - `apps/admin/src/components/portal/recommendation-card.tsx`
   - `apps/admin/src/components/portal/inspection-card.tsx`
   - `apps/admin/src/components/portal/invoice-card.tsx`
3. **Components render**: All components use valid props and hooks

## Commit

```
feat(portal): add client portal UI components

- Add PortalLayout with responsive navigation
- Add DashboardSummary cards for key metrics
- Add PropertyCard with health indicators
- Add ServiceRequestForm with photo upload
- Add RecommendationCard with approve/decline actions
- Add InspectionCard with findings summary
- Add InvoiceCard with payment link
```
