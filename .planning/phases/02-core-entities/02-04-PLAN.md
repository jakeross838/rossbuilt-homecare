# Plan 02-04: Client Management

## Overview

Implement full CRUD for clients with list, detail, create, and edit pages.

## Prerequisites

- Plans 02-01 through 02-03 complete
- Auth and layout working

## Tasks

### 1. Create Client Validation Schema

`lib/validations/client.ts`:

- Zod schema for client form data
- Required: first_name, last_name
- Optional: email, phone, secondary contact fields, billing fields, source, notes, tags
- Email validation
- ZIP code pattern validation
- State code validation (2 letters)

### 2. Create Client Hooks

`hooks/use-clients.ts`:

- `useClients(options)` - List clients with search and active filter
- `useClient(id)` - Single client with properties and user
- `useCreateClient()` - Create mutation
- `useUpdateClient()` - Update mutation
- `useDeleteClient()` - Soft delete mutation (sets is_active = false)

### 3. Create useDebounce Hook

`hooks/use-debounce.ts`:

- Generic debounce hook for search input

### 4. Create Client Form Component

`pages/clients/components/client-form.tsx`:

- Primary contact section (first_name, last_name, email, phone)
- Secondary contact section (optional spouse/assistant)
- Billing information section
- Additional info section (source, referral, notes)
- Form validation with react-hook-form + Zod
- Loading state on submit

### 5. Create Client Pages

**Client List** (`pages/clients/index.tsx`):
- Search input with debounce
- Table with columns: Name, Contact, Properties, Status
- Row click navigates to detail
- Dropdown menu: View, Edit, Delete
- Empty state for no clients
- Loading skeleton
- Delete confirmation dialog

**New Client** (`pages/clients/new.tsx`):
- ClientForm component
- Navigate to client detail on success
- Toast notification on success/error

**Client Detail** (`pages/clients/[id]/index.tsx`):
- Header with name and edit button
- Contact information card
- Secondary contact card
- Billing information card
- Properties list (linked)
- Notes section

**Edit Client** (`pages/clients/[id]/edit.tsx`):
- ClientForm with defaultValues from client data
- Navigate back to detail on success
- Toast notification

### 6. Add Routes

Update `App.tsx` with client routes:
- `/clients` - List
- `/clients/new` - Create
- `/clients/:id` - Detail
- `/clients/:id/edit` - Edit

## Files Created

```
src/
├── lib/
│   └── validations/
│       └── client.ts
├── hooks/
│   ├── use-clients.ts
│   └── use-debounce.ts
└── pages/
    └── clients/
        ├── index.tsx
        ├── new.tsx
        ├── components/
        │   └── client-form.tsx
        └── [id]/
            ├── index.tsx
            └── edit.tsx
```

## Validation

- [ ] Client list displays with search working
- [ ] Can create new client with form validation
- [ ] Client detail page shows all information
- [ ] Can edit client and changes persist
- [ ] Can soft-delete client
- [ ] Empty state shows when no clients
- [ ] Loading states work correctly
- [ ] Toast notifications appear

## Estimated Duration

20-25 minutes
