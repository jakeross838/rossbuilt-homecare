# Plan 02-05: Property Management

## Overview

Implement full CRUD for properties with list, detail, create, and edit pages. Properties belong to clients and have extensive feature tracking.

## Prerequisites

- Plans 02-01 through 02-04 complete
- Client management working

## Tasks

### 1. Create Property Validation Schema

`lib/validations/property.ts`:

- Zod schema for property form data
- Required: client_id, name, address_line1, city, state, zip
- Property details: year_built, square_footage, bedrooms, bathrooms, stories, construction_type, roof_type
- Access codes: gate_code, garage_code, alarm_code, lockbox_code, lockbox_location, wifi_network, wifi_password
- Features: JSONB object with boolean flags for 24 property features (pool, spa, dock, generator, etc.)
- Notes: notes (client-visible), internal_notes (staff only)
- Coerce numbers for numeric fields
- ZIP code pattern validation

### 2. Create Property Hooks

`hooks/use-properties.ts`:

- `useProperties(options)` - List with clientId filter, search, active filter
- `useProperty(id)` - Single property with client, program, equipment, inspections
- `useCreateProperty()` - Create mutation, invalidates client cache too
- `useUpdateProperty()` - Update mutation
- `useDeleteProperty()` - Soft delete mutation

### 3. Create Property Form Component

`pages/properties/components/property-form.tsx`:

- Client selection dropdown (required)
- Property info section (name, address)
- Property details section (year built, sqft, bedrooms, construction type, etc.)
- Access information section (codes, WiFi, instructions)
- Property features section (24 checkboxes in grid)
- Notes section (client-visible + internal)
- Form validation with react-hook-form + Zod

### 4. Create Property Pages

**Property List** (`pages/properties/index.tsx`):
- Search input with debounce
- Client filter dropdown (optional)
- Table with columns: Name, Address, Client, Program Status
- Row click navigates to detail
- Dropdown menu: View, Edit, Delete
- Empty state for no properties
- Delete confirmation dialog

**New Property** (`pages/properties/new.tsx`):
- PropertyForm component
- Optional pre-selected client (from query param)
- Navigate to property detail on success

**Property Detail** (`pages/properties/[id]/index.tsx`):
- Header with name and edit button
- Address and map placeholder
- Property details card
- Access information card (show/hide sensitive codes)
- Features grid (show enabled features)
- Current program card (if enrolled)
- Equipment list (placeholder for Phase 3)
- Recent inspections (placeholder)

**Edit Property** (`pages/properties/[id]/edit.tsx`):
- PropertyForm with defaultValues
- Navigate back to detail on success

### 5. Add Routes

Update `App.tsx` with property routes:
- `/properties` - List
- `/properties/new` - Create
- `/properties/new?client=<id>` - Create with pre-selected client
- `/properties/:id` - Detail
- `/properties/:id/edit` - Edit

### 6. Link Properties from Client Detail

Update client detail page to:
- Show list of properties
- "Add Property" button that links to `/properties/new?client=<clientId>`

## Files Created

```
src/
├── lib/
│   └── validations/
│       └── property.ts
├── hooks/
│   └── use-properties.ts
└── pages/
    └── properties/
        ├── index.tsx
        ├── new.tsx
        ├── components/
        │   └── property-form.tsx
        └── [id]/
            ├── index.tsx
            └── edit.tsx
```

## Updated Files

- `pages/clients/[id]/index.tsx` - Add properties list and link

## Validation

- [ ] Property list displays with search working
- [ ] Can filter properties by client
- [ ] Can create property with client selection
- [ ] Property features checkboxes work correctly
- [ ] Property detail shows all information
- [ ] Access codes can be shown/hidden
- [ ] Can edit property and changes persist
- [ ] Can soft-delete property
- [ ] Properties appear on client detail page
- [ ] "Add Property" from client works

## Estimated Duration

20-25 minutes
