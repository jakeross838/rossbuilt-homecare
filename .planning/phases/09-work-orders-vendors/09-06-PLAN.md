# Plan 09-06: Vendor UI Components

## Wave
3

## Dependencies
- 09-02: Vendor Data Foundation (types, constants, validations)
- 09-04: Vendor Hooks (React Query hooks)

## Objective
Create reusable UI components for vendor management including forms, cards, compliance indicators, and detail views.

## Why This Plan
Vendors need comprehensive UI components:
- Vendor cards for list views
- Compliance badges and indicators
- Create/edit vendor forms
- Trade category chips
- Rating display
- Performance stats display

## Files to Create

### 1. `apps/admin/src/components/vendors/vendor-compliance-badge.tsx`
Compliance status indicator.

```typescript
import { Badge } from '@/components/ui/badge'
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip'
import { CheckCircle, AlertTriangle, XCircle } from 'lucide-react'
import type { VendorCompliance } from '@/lib/types/vendor'

interface VendorComplianceBadgeProps {
  compliance: VendorCompliance
  showDetails?: boolean
}

export function VendorComplianceBadge({
  compliance,
  showDetails = false,
}: VendorComplianceBadgeProps) {
  const { is_compliant, issues, license_expires_soon, insurance_expires_soon } =
    compliance

  if (is_compliant && !license_expires_soon && !insurance_expires_soon) {
    return (
      <Badge variant="default" className="bg-green-100 text-green-800 hover:bg-green-100">
        <CheckCircle className="mr-1 h-3 w-3" />
        Compliant
      </Badge>
    )
  }

  if (is_compliant && (license_expires_soon || insurance_expires_soon)) {
    return (
      <TooltipProvider>
        <Tooltip>
          <TooltipTrigger asChild>
            <Badge
              variant="secondary"
              className="bg-yellow-100 text-yellow-800 hover:bg-yellow-100 cursor-help"
            >
              <AlertTriangle className="mr-1 h-3 w-3" />
              Expiring Soon
            </Badge>
          </TooltipTrigger>
          <TooltipContent>
            <ul className="text-xs space-y-1">
              {license_expires_soon && <li>License expires within 30 days</li>}
              {insurance_expires_soon && <li>Insurance expires within 30 days</li>}
            </ul>
          </TooltipContent>
        </Tooltip>
      </TooltipProvider>
    )
  }

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <Badge variant="destructive" className="cursor-help">
            <XCircle className="mr-1 h-3 w-3" />
            Issues
          </Badge>
        </TooltipTrigger>
        <TooltipContent>
          <ul className="text-xs space-y-1">
            {issues.map((issue, i) => (
              <li key={i}>{issue}</li>
            ))}
          </ul>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  )
}
```

### 2. `apps/admin/src/components/vendors/vendor-rating.tsx`
Star rating display component.

```typescript
import { Star } from 'lucide-react'
import { formatRating, getRatingLabel } from '@/lib/constants/vendor'
import { cn } from '@/lib/utils'

interface VendorRatingProps {
  rating: number | null
  showLabel?: boolean
  size?: 'sm' | 'md' | 'lg'
  className?: string
}

export function VendorRating({
  rating,
  showLabel = false,
  size = 'md',
  className,
}: VendorRatingProps) {
  if (rating === null) {
    return (
      <span className={cn('text-muted-foreground', className)}>
        No rating yet
      </span>
    )
  }

  const sizes = {
    sm: 'h-3 w-3',
    md: 'h-4 w-4',
    lg: 'h-5 w-5',
  }

  const textSizes = {
    sm: 'text-xs',
    md: 'text-sm',
    lg: 'text-base',
  }

  const fullStars = Math.floor(rating)
  const hasHalfStar = rating % 1 >= 0.5

  return (
    <div className={cn('flex items-center gap-1', className)}>
      <div className="flex">
        {[1, 2, 3, 4, 5].map((star) => (
          <Star
            key={star}
            className={cn(
              sizes[size],
              star <= fullStars
                ? 'fill-yellow-400 text-yellow-400'
                : star === fullStars + 1 && hasHalfStar
                  ? 'fill-yellow-400/50 text-yellow-400'
                  : 'text-gray-300'
            )}
          />
        ))}
      </div>
      <span className={cn('font-medium', textSizes[size])}>
        {rating.toFixed(1)}
      </span>
      {showLabel && (
        <span className={cn('text-muted-foreground', textSizes[size])}>
          ({getRatingLabel(rating)})
        </span>
      )}
    </div>
  )
}
```

### 3. `apps/admin/src/components/vendors/vendor-trade-badges.tsx`
Trade category badges component.

```typescript
import { Badge } from '@/components/ui/badge'
import { getTradeCategoryLabel } from '@/lib/constants/vendor'

interface VendorTradeBadgesProps {
  trades: string[]
  maxShow?: number
  className?: string
}

export function VendorTradeBadges({
  trades,
  maxShow = 3,
  className,
}: VendorTradeBadgesProps) {
  if (!trades || trades.length === 0) {
    return null
  }

  const visibleTrades = trades.slice(0, maxShow)
  const remainingCount = trades.length - maxShow

  return (
    <div className={className}>
      <div className="flex flex-wrap gap-1">
        {visibleTrades.map((trade) => (
          <Badge key={trade} variant="outline" className="text-xs">
            {getTradeCategoryLabel(trade)}
          </Badge>
        ))}
        {remainingCount > 0 && (
          <Badge variant="outline" className="text-xs">
            +{remainingCount} more
          </Badge>
        )}
      </div>
    </div>
  )
}
```

### 4. `apps/admin/src/components/vendors/vendor-card.tsx`
Card component for vendor list views.

```typescript
import { Card, CardContent, CardHeader } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { VendorRating } from './vendor-rating'
import { VendorTradeBadges } from './vendor-trade-badges'
import { VendorComplianceBadge } from './vendor-compliance-badge'
import { checkVendorCompliance } from '@/lib/constants/vendor'
import { Phone, Mail, Star, ChevronRight } from 'lucide-react'
import type { VendorListItem } from '@/lib/types/vendor'

interface VendorCardProps {
  vendor: VendorListItem
  onClick?: () => void
}

export function VendorCard({ vendor, onClick }: VendorCardProps) {
  // Create a minimal compliance check for the card
  const compliance = checkVendorCompliance({
    license_expiration: null, // We don't have these in list view
    insurance_expiration: null,
    w9_on_file: null,
  })

  return (
    <Card
      className="cursor-pointer hover:bg-accent/50 transition-colors"
      onClick={onClick}
    >
      <CardHeader className="pb-2">
        <div className="flex items-start justify-between">
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <h3 className="font-semibold">{vendor.company_name}</h3>
              {vendor.is_preferred && (
                <Badge variant="secondary">
                  <Star className="mr-1 h-3 w-3 fill-yellow-400 text-yellow-400" />
                  Preferred
                </Badge>
              )}
            </div>
            {vendor.contact_name && (
              <p className="text-sm text-muted-foreground">
                {vendor.contact_name}
              </p>
            )}
          </div>
          <Button variant="ghost" size="icon" className="shrink-0">
            <ChevronRight className="h-4 w-4" />
          </Button>
        </div>
      </CardHeader>
      <CardContent className="pt-0">
        <div className="space-y-3">
          <VendorTradeBadges trades={vendor.trade_categories} />

          <div className="flex items-center gap-4 text-sm text-muted-foreground">
            {vendor.phone && (
              <div className="flex items-center gap-1">
                <Phone className="h-3 w-3" />
                {vendor.phone}
              </div>
            )}
            {vendor.email && (
              <div className="flex items-center gap-1">
                <Mail className="h-3 w-3" />
                {vendor.email}
              </div>
            )}
          </div>

          <div className="flex items-center justify-between">
            <VendorRating rating={vendor.average_rating} size="sm" />
            <span className="text-sm text-muted-foreground">
              {vendor.completed_jobs} / {vendor.total_jobs} jobs completed
            </span>
          </div>
        </div>
      </CardContent>
    </Card>
  )
}
```

### 5. `apps/admin/src/components/vendors/vendor-form.tsx`
Form for creating/editing vendors.

```typescript
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import { Checkbox } from '@/components/ui/checkbox'
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import {
  createVendorSchema,
  type CreateVendorFormData,
} from '@/lib/validations/vendor'
import { TRADE_CATEGORIES, US_STATES } from '@/lib/constants/vendor'
import type { Resolver } from 'react-hook-form'

interface VendorFormProps {
  defaultValues?: Partial<CreateVendorFormData>
  onSubmit: (data: CreateVendorFormData) => void
  onCancel: () => void
  isLoading?: boolean
  isEdit?: boolean
}

export function VendorForm({
  defaultValues,
  onSubmit,
  onCancel,
  isLoading,
  isEdit = false,
}: VendorFormProps) {
  const form = useForm<CreateVendorFormData>({
    resolver: zodResolver(createVendorSchema) as Resolver<CreateVendorFormData>,
    defaultValues: {
      company_name: '',
      contact_first_name: '',
      contact_last_name: '',
      email: '',
      phone: '',
      address_line1: '',
      address_line2: '',
      city: '',
      state: undefined,
      zip: '',
      trade_categories: [],
      is_preferred: false,
      notes: '',
      ...defaultValues,
    },
  })

  const selectedTrades = form.watch('trade_categories') || []

  const toggleTrade = (trade: string) => {
    const current = form.getValues('trade_categories') || []
    if (current.includes(trade)) {
      form.setValue(
        'trade_categories',
        current.filter((t) => t !== trade)
      )
    } else {
      form.setValue('trade_categories', [...current, trade])
    }
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
        {/* Company Info */}
        <div className="space-y-4">
          <h3 className="font-medium">Company Information</h3>

          <FormField
            control={form.control}
            name="company_name"
            render={({ field }) => (
              <FormItem>
                <FormLabel>Company Name</FormLabel>
                <FormControl>
                  <Input placeholder="ABC Plumbing Co." {...field} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />

          <div className="grid grid-cols-2 gap-4">
            <FormField
              control={form.control}
              name="contact_first_name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Contact First Name</FormLabel>
                  <FormControl>
                    <Input {...field} value={field.value ?? ''} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="contact_last_name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Contact Last Name</FormLabel>
                  <FormControl>
                    <Input {...field} value={field.value ?? ''} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
          </div>

          <div className="grid grid-cols-2 gap-4">
            <FormField
              control={form.control}
              name="email"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Email</FormLabel>
                  <FormControl>
                    <Input
                      type="email"
                      placeholder="contact@example.com"
                      {...field}
                      value={field.value ?? ''}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="phone"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Phone</FormLabel>
                  <FormControl>
                    <Input
                      type="tel"
                      placeholder="(813) 555-0100"
                      {...field}
                      value={field.value ?? ''}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
          </div>
        </div>

        {/* Address */}
        <div className="space-y-4">
          <h3 className="font-medium">Address</h3>

          <FormField
            control={form.control}
            name="address_line1"
            render={({ field }) => (
              <FormItem>
                <FormLabel>Address Line 1</FormLabel>
                <FormControl>
                  <Input {...field} value={field.value ?? ''} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />

          <FormField
            control={form.control}
            name="address_line2"
            render={({ field }) => (
              <FormItem>
                <FormLabel>Address Line 2</FormLabel>
                <FormControl>
                  <Input {...field} value={field.value ?? ''} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />

          <div className="grid grid-cols-3 gap-4">
            <FormField
              control={form.control}
              name="city"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>City</FormLabel>
                  <FormControl>
                    <Input {...field} value={field.value ?? ''} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="state"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>State</FormLabel>
                  <Select
                    onValueChange={field.onChange}
                    value={field.value ?? undefined}
                  >
                    <FormControl>
                      <SelectTrigger>
                        <SelectValue placeholder="Select" />
                      </SelectTrigger>
                    </FormControl>
                    <SelectContent>
                      {US_STATES.map((state) => (
                        <SelectItem key={state.value} value={state.value}>
                          {state.label}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="zip"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>ZIP Code</FormLabel>
                  <FormControl>
                    <Input
                      placeholder="33602"
                      {...field}
                      value={field.value ?? ''}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
          </div>
        </div>

        {/* Trade Categories */}
        <div className="space-y-4">
          <h3 className="font-medium">Trade Categories</h3>
          <FormDescription>
            Select all services this vendor provides
          </FormDescription>
          <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
            {TRADE_CATEGORIES.map((trade) => (
              <label
                key={trade.value}
                className={`flex items-center gap-2 p-2 border rounded-md cursor-pointer hover:bg-accent/50 ${
                  selectedTrades.includes(trade.value)
                    ? 'border-primary bg-accent/50'
                    : ''
                }`}
              >
                <Checkbox
                  checked={selectedTrades.includes(trade.value)}
                  onCheckedChange={() => toggleTrade(trade.value)}
                />
                <span className="text-sm">{trade.label}</span>
              </label>
            ))}
          </div>
        </div>

        {/* Preferences */}
        <FormField
          control={form.control}
          name="is_preferred"
          render={({ field }) => (
            <FormItem className="flex items-center gap-2">
              <FormControl>
                <Checkbox
                  checked={field.value}
                  onCheckedChange={field.onChange}
                />
              </FormControl>
              <FormLabel className="!mt-0">Mark as Preferred Vendor</FormLabel>
            </FormItem>
          )}
        />

        {/* Notes */}
        <FormField
          control={form.control}
          name="notes"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Notes (optional)</FormLabel>
              <FormControl>
                <Textarea
                  placeholder="Any additional notes about this vendor..."
                  rows={3}
                  {...field}
                  value={field.value ?? ''}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <div className="flex justify-end gap-2">
          <Button type="button" variant="outline" onClick={onCancel}>
            Cancel
          </Button>
          <Button type="submit" disabled={isLoading}>
            {isLoading
              ? isEdit
                ? 'Saving...'
                : 'Creating...'
              : isEdit
                ? 'Save Changes'
                : 'Create Vendor'}
          </Button>
        </div>
      </form>
    </Form>
  )
}
```

### 6. `apps/admin/src/components/vendors/vendor-compliance-form.tsx`
Form for updating vendor compliance information.

```typescript
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Checkbox } from '@/components/ui/checkbox'
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'
import {
  vendorComplianceSchema,
  type VendorComplianceFormData,
} from '@/lib/validations/vendor'
import type { Resolver } from 'react-hook-form'

interface VendorComplianceFormProps {
  defaultValues?: Partial<VendorComplianceFormData>
  onSubmit: (data: VendorComplianceFormData) => void
  onCancel: () => void
  isLoading?: boolean
}

export function VendorComplianceForm({
  defaultValues,
  onSubmit,
  onCancel,
  isLoading,
}: VendorComplianceFormProps) {
  const form = useForm<VendorComplianceFormData>({
    resolver: zodResolver(vendorComplianceSchema) as Resolver<VendorComplianceFormData>,
    defaultValues: {
      license_number: '',
      license_expiration: '',
      insurance_company: '',
      insurance_policy_number: '',
      insurance_expiration: '',
      w9_on_file: false,
      w9_received_date: '',
      ...defaultValues,
    },
  })

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
        {/* License Info */}
        <div className="space-y-4">
          <h3 className="font-medium">License Information</h3>
          <div className="grid grid-cols-2 gap-4">
            <FormField
              control={form.control}
              name="license_number"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>License Number</FormLabel>
                  <FormControl>
                    <Input {...field} value={field.value ?? ''} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="license_expiration"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Expiration Date</FormLabel>
                  <FormControl>
                    <Input type="date" {...field} value={field.value ?? ''} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
          </div>
        </div>

        {/* Insurance Info */}
        <div className="space-y-4">
          <h3 className="font-medium">Insurance Information</h3>
          <div className="grid grid-cols-2 gap-4">
            <FormField
              control={form.control}
              name="insurance_company"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Insurance Company</FormLabel>
                  <FormControl>
                    <Input {...field} value={field.value ?? ''} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="insurance_policy_number"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Policy Number</FormLabel>
                  <FormControl>
                    <Input {...field} value={field.value ?? ''} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
          </div>
          <FormField
            control={form.control}
            name="insurance_expiration"
            render={({ field }) => (
              <FormItem>
                <FormLabel>Expiration Date</FormLabel>
                <FormControl>
                  <Input type="date" {...field} value={field.value ?? ''} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
        </div>

        {/* W-9 Info */}
        <div className="space-y-4">
          <h3 className="font-medium">W-9 Form</h3>
          <FormField
            control={form.control}
            name="w9_on_file"
            render={({ field }) => (
              <FormItem className="flex items-center gap-2">
                <FormControl>
                  <Checkbox
                    checked={field.value}
                    onCheckedChange={field.onChange}
                  />
                </FormControl>
                <FormLabel className="!mt-0">W-9 on file</FormLabel>
              </FormItem>
            )}
          />
          {form.watch('w9_on_file') && (
            <FormField
              control={form.control}
              name="w9_received_date"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Date Received</FormLabel>
                  <FormControl>
                    <Input type="date" {...field} value={field.value ?? ''} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
          )}
        </div>

        <div className="flex justify-end gap-2">
          <Button type="button" variant="outline" onClick={onCancel}>
            Cancel
          </Button>
          <Button type="submit" disabled={isLoading}>
            {isLoading ? 'Saving...' : 'Save Compliance Info'}
          </Button>
        </div>
      </form>
    </Form>
  )
}
```

### 7. `apps/admin/src/components/vendors/index.ts`
Export file.

```typescript
export { VendorComplianceBadge } from './vendor-compliance-badge'
export { VendorRating } from './vendor-rating'
export { VendorTradeBadges } from './vendor-trade-badges'
export { VendorCard } from './vendor-card'
export { VendorForm } from './vendor-form'
export { VendorComplianceForm } from './vendor-compliance-form'
```

## Verification
- [ ] VendorComplianceBadge shows correct status with tooltips
- [ ] VendorRating displays stars correctly for all values
- [ ] VendorTradeBadges shows trade categories with overflow
- [ ] VendorCard displays all vendor information
- [ ] VendorForm validates and submits correctly
- [ ] VendorComplianceForm handles all compliance fields
- [ ] All components are exported from index
- [ ] No TypeScript errors
