# Plan 09-05: Work Order UI Components

## Wave
3

## Dependencies
- 09-01: Work Order Data Foundation (types, constants, validations)
- 09-03: Work Order Hooks (React Query hooks)

## Objective
Create reusable UI components for work order management including forms, cards, status badges, and dialogs for the various work order actions.

## Why This Plan
Work orders have complex UI requirements:
- Create work order form (from recommendation or manual)
- Work order cards for list views
- Status badges with color coding
- Priority badges
- Status transition buttons
- Vendor assignment dialog
- Completion dialog with cost entry
- Photo upload for before/after

## Files to Create

### 1. `apps/admin/src/components/work-orders/work-order-status-badge.tsx`
Status badge component with consistent styling.

```typescript
import { Badge } from '@/components/ui/badge'
import { WORK_ORDER_STATUS, getStatusBadgeVariant } from '@/lib/constants/work-order'
import type { WorkOrderStatus } from '@/lib/types/work-order'

interface WorkOrderStatusBadgeProps {
  status: WorkOrderStatus
  className?: string
}

export function WorkOrderStatusBadge({
  status,
  className,
}: WorkOrderStatusBadgeProps) {
  const config = WORK_ORDER_STATUS[status]
  const variant = getStatusBadgeVariant(status)

  return (
    <Badge variant={variant} className={className}>
      {config.label}
    </Badge>
  )
}
```

### 2. `apps/admin/src/components/work-orders/work-order-priority-badge.tsx`
Priority badge component.

```typescript
import { Badge } from '@/components/ui/badge'
import {
  ArrowDown,
  Minus,
  ArrowUp,
  AlertTriangle,
} from 'lucide-react'
import { PRIORITY_LEVELS, getPriorityBadgeVariant } from '@/lib/constants/work-order'
import type { PriorityLevel } from '@/lib/types/work-order'

interface WorkOrderPriorityBadgeProps {
  priority: PriorityLevel | null
  showIcon?: boolean
  className?: string
}

const PRIORITY_ICONS = {
  low: ArrowDown,
  medium: Minus,
  high: ArrowUp,
  urgent: AlertTriangle,
}

export function WorkOrderPriorityBadge({
  priority,
  showIcon = true,
  className,
}: WorkOrderPriorityBadgeProps) {
  if (!priority) return null

  const config = PRIORITY_LEVELS[priority]
  const variant = getPriorityBadgeVariant(priority)
  const Icon = PRIORITY_ICONS[priority]

  return (
    <Badge variant={variant} className={className}>
      {showIcon && <Icon className="mr-1 h-3 w-3" />}
      {config.label}
    </Badge>
  )
}
```

### 3. `apps/admin/src/components/work-orders/work-order-card.tsx`
Card component for displaying work orders in lists.

```typescript
import { Card, CardContent, CardHeader } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { WorkOrderStatusBadge } from './work-order-status-badge'
import { WorkOrderPriorityBadge } from './work-order-priority-badge'
import { formatWorkOrderNumber } from '@/lib/constants/work-order'
import {
  MapPin,
  Calendar,
  DollarSign,
  Building2,
  ChevronRight,
} from 'lucide-react'
import type { WorkOrderListItem } from '@/lib/types/work-order'
import { format } from 'date-fns'

interface WorkOrderCardProps {
  workOrder: WorkOrderListItem
  onClick?: () => void
}

export function WorkOrderCard({ workOrder, onClick }: WorkOrderCardProps) {
  return (
    <Card
      className="cursor-pointer hover:bg-accent/50 transition-colors"
      onClick={onClick}
    >
      <CardHeader className="pb-2">
        <div className="flex items-start justify-between">
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <span className="text-sm font-mono text-muted-foreground">
                {formatWorkOrderNumber(workOrder.work_order_number)}
              </span>
              <WorkOrderStatusBadge status={workOrder.status} />
              <WorkOrderPriorityBadge priority={workOrder.priority} />
            </div>
            <h3 className="font-semibold leading-tight">{workOrder.title}</h3>
          </div>
          <Button variant="ghost" size="icon" className="shrink-0">
            <ChevronRight className="h-4 w-4" />
          </Button>
        </div>
      </CardHeader>
      <CardContent className="pt-0">
        <div className="grid gap-2 text-sm text-muted-foreground">
          <div className="flex items-center gap-2">
            <MapPin className="h-4 w-4 shrink-0" />
            <span className="truncate">
              {workOrder.property_name} — {workOrder.property_address}
            </span>
          </div>
          {workOrder.vendor_name && (
            <div className="flex items-center gap-2">
              <Building2 className="h-4 w-4 shrink-0" />
              <span>{workOrder.vendor_name}</span>
            </div>
          )}
          <div className="flex items-center gap-4">
            {workOrder.scheduled_date && (
              <div className="flex items-center gap-2">
                <Calendar className="h-4 w-4 shrink-0" />
                <span>{format(new Date(workOrder.scheduled_date), 'MMM d, yyyy')}</span>
              </div>
            )}
            {workOrder.estimated_cost && (
              <div className="flex items-center gap-2">
                <DollarSign className="h-4 w-4 shrink-0" />
                <span>${workOrder.estimated_cost.toLocaleString()}</span>
              </div>
            )}
          </div>
        </div>
      </CardContent>
    </Card>
  )
}
```

### 4. `apps/admin/src/components/work-orders/work-order-form.tsx`
Form component for creating/editing work orders.

```typescript
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import {
  createWorkOrderSchema,
  type CreateWorkOrderFormData,
} from '@/lib/validations/work-order'
import { WORK_ORDER_CATEGORIES, PRIORITY_LEVELS } from '@/lib/constants/work-order'
import type { Resolver } from 'react-hook-form'

interface WorkOrderFormProps {
  defaultValues?: Partial<CreateWorkOrderFormData>
  propertyId: string
  clientId: string
  recommendationId?: string
  onSubmit: (data: CreateWorkOrderFormData) => void
  onCancel: () => void
  isLoading?: boolean
}

export function WorkOrderForm({
  defaultValues,
  propertyId,
  clientId,
  recommendationId,
  onSubmit,
  onCancel,
  isLoading,
}: WorkOrderFormProps) {
  const form = useForm<CreateWorkOrderFormData>({
    resolver: zodResolver(createWorkOrderSchema) as Resolver<CreateWorkOrderFormData>,
    defaultValues: {
      property_id: propertyId,
      client_id: clientId,
      recommendation_id: recommendationId,
      title: '',
      description: '',
      category: undefined,
      priority: 'medium',
      ...defaultValues,
    },
  })

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="title"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Title</FormLabel>
              <FormControl>
                <Input placeholder="Brief description of work needed" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <FormField
          control={form.control}
          name="description"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Description</FormLabel>
              <FormControl>
                <Textarea
                  placeholder="Detailed description of the work to be performed..."
                  rows={4}
                  {...field}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <div className="grid grid-cols-2 gap-4">
          <FormField
            control={form.control}
            name="category"
            render={({ field }) => (
              <FormItem>
                <FormLabel>Category</FormLabel>
                <Select
                  onValueChange={field.onChange}
                  defaultValue={field.value}
                >
                  <FormControl>
                    <SelectTrigger>
                      <SelectValue placeholder="Select category" />
                    </SelectTrigger>
                  </FormControl>
                  <SelectContent>
                    {WORK_ORDER_CATEGORIES.map((category) => (
                      <SelectItem key={category.value} value={category.value}>
                        {category.label}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
                <FormMessage />
              </FormItem>
            )}
          />

          <FormField
            control={form.control}
            name="priority"
            render={({ field }) => (
              <FormItem>
                <FormLabel>Priority</FormLabel>
                <Select
                  onValueChange={field.onChange}
                  defaultValue={field.value}
                >
                  <FormControl>
                    <SelectTrigger>
                      <SelectValue placeholder="Select priority" />
                    </SelectTrigger>
                  </FormControl>
                  <SelectContent>
                    {Object.entries(PRIORITY_LEVELS).map(([value, config]) => (
                      <SelectItem key={value} value={value}>
                        {config.label}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
                <FormMessage />
              </FormItem>
            )}
          />
        </div>

        <FormField
          control={form.control}
          name="estimated_cost"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Estimated Cost (optional)</FormLabel>
              <FormControl>
                <Input
                  type="number"
                  min={0}
                  step={0.01}
                  placeholder="0.00"
                  {...field}
                  value={field.value ?? ''}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <FormField
          control={form.control}
          name="internal_notes"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Internal Notes (optional)</FormLabel>
              <FormControl>
                <Textarea
                  placeholder="Notes visible only to staff..."
                  rows={2}
                  {...field}
                  value={field.value ?? ''}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <div className="flex justify-end gap-2 pt-4">
          <Button type="button" variant="outline" onClick={onCancel}>
            Cancel
          </Button>
          <Button type="submit" disabled={isLoading}>
            {isLoading ? 'Creating...' : 'Create Work Order'}
          </Button>
        </div>
      </form>
    </Form>
  )
}
```

### 5. `apps/admin/src/components/work-orders/assign-vendor-dialog.tsx`
Dialog for assigning a vendor to a work order.

```typescript
import { useState } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'
import { Badge } from '@/components/ui/badge'
import { Star, AlertTriangle, CheckCircle } from 'lucide-react'
import { useVendorsByTrade } from '@/hooks/use-vendors'
import {
  assignVendorSchema,
  type AssignVendorFormData,
} from '@/lib/validations/work-order'
import { formatRating } from '@/lib/constants/vendor'
import type { Resolver } from 'react-hook-form'

interface AssignVendorDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  workOrderId: string
  category: string | null
  onAssign: (data: AssignVendorFormData) => void
  isLoading?: boolean
}

export function AssignVendorDialog({
  open,
  onOpenChange,
  workOrderId,
  category,
  onAssign,
  isLoading,
}: AssignVendorDialogProps) {
  const { data: vendors = [], isLoading: loadingVendors } = useVendorsByTrade(
    category || undefined
  )

  const form = useForm<AssignVendorFormData>({
    resolver: zodResolver(assignVendorSchema) as Resolver<AssignVendorFormData>,
    defaultValues: {
      vendor_id: '',
      scheduled_date: '',
      scheduled_time_start: '',
      scheduled_time_end: '',
      estimated_cost: undefined,
    },
  })

  const handleSubmit = (data: AssignVendorFormData) => {
    onAssign(data)
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-lg">
        <DialogHeader>
          <DialogTitle>Assign Vendor</DialogTitle>
          <DialogDescription>
            Select a vendor to assign to this work order
            {category && ` (${category})`}
          </DialogDescription>
        </DialogHeader>

        <Form {...form}>
          <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="vendor_id"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Select Vendor</FormLabel>
                  <FormControl>
                    <RadioGroup
                      onValueChange={field.onChange}
                      value={field.value}
                      className="space-y-2"
                    >
                      {loadingVendors ? (
                        <p className="text-sm text-muted-foreground">
                          Loading vendors...
                        </p>
                      ) : vendors.length === 0 ? (
                        <p className="text-sm text-muted-foreground">
                          No vendors available for this category
                        </p>
                      ) : (
                        vendors.map((vendor) => (
                          <label
                            key={vendor.id}
                            className={`flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-accent/50 ${
                              field.value === vendor.id
                                ? 'border-primary bg-accent/50'
                                : ''
                            }`}
                          >
                            <RadioGroupItem
                              value={vendor.id}
                              className="sr-only"
                            />
                            <div className="flex-1 min-w-0">
                              <div className="flex items-center gap-2">
                                <span className="font-medium">
                                  {vendor.company_name}
                                </span>
                                {vendor.is_preferred && (
                                  <Badge variant="secondary">Preferred</Badge>
                                )}
                              </div>
                              {vendor.contact_name && (
                                <p className="text-sm text-muted-foreground">
                                  {vendor.contact_name}
                                  {vendor.phone && ` • ${vendor.phone}`}
                                </p>
                              )}
                              <div className="flex items-center gap-3 mt-1">
                                {vendor.average_rating && (
                                  <span className="flex items-center gap-1 text-sm">
                                    <Star className="h-3 w-3 fill-yellow-400 text-yellow-400" />
                                    {formatRating(vendor.average_rating)}
                                  </span>
                                )}
                                {vendor.compliance.is_compliant ? (
                                  <span className="flex items-center gap-1 text-sm text-green-600">
                                    <CheckCircle className="h-3 w-3" />
                                    Compliant
                                  </span>
                                ) : (
                                  <span className="flex items-center gap-1 text-sm text-yellow-600">
                                    <AlertTriangle className="h-3 w-3" />
                                    {vendor.compliance.issues[0]}
                                  </span>
                                )}
                              </div>
                            </div>
                          </label>
                        ))
                      )}
                    </RadioGroup>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            <div className="grid grid-cols-3 gap-4">
              <FormField
                control={form.control}
                name="scheduled_date"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Date (optional)</FormLabel>
                    <FormControl>
                      <Input type="date" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="scheduled_time_start"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Start Time</FormLabel>
                    <FormControl>
                      <Input type="time" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="scheduled_time_end"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>End Time</FormLabel>
                    <FormControl>
                      <Input type="time" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
            </div>

            <FormField
              control={form.control}
              name="estimated_cost"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Estimated Cost (optional)</FormLabel>
                  <FormControl>
                    <Input
                      type="number"
                      min={0}
                      step={0.01}
                      placeholder="0.00"
                      {...field}
                      value={field.value ?? ''}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            <div className="flex justify-end gap-2 pt-4">
              <Button
                type="button"
                variant="outline"
                onClick={() => onOpenChange(false)}
              >
                Cancel
              </Button>
              <Button type="submit" disabled={isLoading || !form.watch('vendor_id')}>
                {isLoading ? 'Assigning...' : 'Assign Vendor'}
              </Button>
            </div>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  )
}
```

### 6. `apps/admin/src/components/work-orders/complete-work-order-dialog.tsx`
Dialog for marking a work order as complete.

```typescript
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form'
import {
  completeWorkOrderSchema,
  type CompleteWorkOrderFormData,
} from '@/lib/validations/work-order'
import { calculateClientCost, DEFAULT_MARKUP_PERCENT } from '@/lib/constants/work-order'
import type { Resolver } from 'react-hook-form'

interface CompleteWorkOrderDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  workOrderId: string
  estimatedCost: number | null
  onComplete: (data: CompleteWorkOrderFormData) => void
  isLoading?: boolean
}

export function CompleteWorkOrderDialog({
  open,
  onOpenChange,
  workOrderId,
  estimatedCost,
  onComplete,
  isLoading,
}: CompleteWorkOrderDialogProps) {
  const form = useForm<CompleteWorkOrderFormData>({
    resolver: zodResolver(completeWorkOrderSchema) as Resolver<CompleteWorkOrderFormData>,
    defaultValues: {
      actual_cost: estimatedCost || 0,
      markup_percent: DEFAULT_MARKUP_PERCENT,
      completion_notes: '',
    },
  })

  const actualCost = form.watch('actual_cost')
  const markupPercent = form.watch('markup_percent')
  const { markupAmount, totalCost } = calculateClientCost(
    actualCost || 0,
    markupPercent || DEFAULT_MARKUP_PERCENT
  )

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Complete Work Order</DialogTitle>
          <DialogDescription>
            Enter the final costs and any completion notes
          </DialogDescription>
        </DialogHeader>

        <Form {...form}>
          <form onSubmit={form.handleSubmit(onComplete)} className="space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <FormField
                control={form.control}
                name="actual_cost"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Vendor Cost</FormLabel>
                    <FormControl>
                      <Input
                        type="number"
                        min={0}
                        step={0.01}
                        {...field}
                      />
                    </FormControl>
                    <FormDescription>Amount paid to vendor</FormDescription>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={form.control}
                name="markup_percent"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Markup %</FormLabel>
                    <FormControl>
                      <Input
                        type="number"
                        min={0}
                        max={100}
                        step={0.5}
                        {...field}
                      />
                    </FormControl>
                    <FormDescription>Ross Built markup</FormDescription>
                    <FormMessage />
                  </FormItem>
                )}
              />
            </div>

            <div className="p-4 bg-muted rounded-lg">
              <h4 className="font-medium mb-2">Cost Summary</h4>
              <div className="space-y-1 text-sm">
                <div className="flex justify-between">
                  <span>Vendor Cost:</span>
                  <span>${(actualCost || 0).toFixed(2)}</span>
                </div>
                <div className="flex justify-between">
                  <span>Markup ({markupPercent || DEFAULT_MARKUP_PERCENT}%):</span>
                  <span>${markupAmount.toFixed(2)}</span>
                </div>
                <div className="flex justify-between font-medium pt-1 border-t">
                  <span>Client Total:</span>
                  <span>${totalCost.toFixed(2)}</span>
                </div>
              </div>
            </div>

            <FormField
              control={form.control}
              name="completion_notes"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Completion Notes (optional)</FormLabel>
                  <FormControl>
                    <Textarea
                      placeholder="Notes about the completed work..."
                      rows={3}
                      {...field}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            <div className="flex justify-end gap-2 pt-4">
              <Button
                type="button"
                variant="outline"
                onClick={() => onOpenChange(false)}
              >
                Cancel
              </Button>
              <Button type="submit" disabled={isLoading}>
                {isLoading ? 'Completing...' : 'Mark Complete'}
              </Button>
            </div>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  )
}
```

### 7. `apps/admin/src/components/work-orders/index.ts`
Export file.

```typescript
export { WorkOrderStatusBadge } from './work-order-status-badge'
export { WorkOrderPriorityBadge } from './work-order-priority-badge'
export { WorkOrderCard } from './work-order-card'
export { WorkOrderForm } from './work-order-form'
export { AssignVendorDialog } from './assign-vendor-dialog'
export { CompleteWorkOrderDialog } from './complete-work-order-dialog'
```

## Verification
- [ ] WorkOrderStatusBadge displays correct colors for all statuses
- [ ] WorkOrderPriorityBadge displays correct colors and icons
- [ ] WorkOrderCard displays all work order information
- [ ] WorkOrderForm validates and submits correctly
- [ ] AssignVendorDialog shows vendors by trade and handles assignment
- [ ] CompleteWorkOrderDialog calculates costs correctly
- [ ] All components are exported from index
- [ ] No TypeScript errors
