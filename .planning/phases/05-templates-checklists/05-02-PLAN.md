---
phase: 05-templates-checklists
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - apps/admin/src/lib/validations/inspection-template.ts
  - apps/admin/src/hooks/use-inspection-templates.ts
autonomous: true
---

<objective>
Create validation schemas and React Query hooks for inspection template CRUD.

Purpose: Enable template management with type-safe validation and data operations.
Output: Zod schemas for templates and React Query hooks for CRUD.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Prior plan output:
@.planning/phases/05-templates-checklists/05-01-SUMMARY.md

Reference document:
@C:/Users/Jake/Downloads/home-care-os-docs/phase-05-templates-checklists.md

Database schema:
@C:/Users/Jake/home-care-os/supabase/migrations/007_inspection_templates.sql

Existing hook patterns:
@C:/Users/Jake/home-care-os/apps/admin/src/hooks/use-equipment.ts
@C:/Users/Jake/home-care-os/apps/admin/src/hooks/use-programs.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template validation schema</name>
  <files>apps/admin/src/lib/validations/inspection-template.ts</files>
  <action>
Create Zod schemas for inspection templates:

1. checklistItemSchema:
   - id: z.string()
   - text: z.string().min(1)
   - type: z.enum(['status', 'text', 'number', 'select', 'photo']).default('status')
   - options: z.array(z.string()).optional()
   - photo_required: z.boolean().default(false)
   - photo_recommended: z.boolean().default(false)
   - help_text: z.string().optional()
   - recommendation_template_key: z.string().optional()

2. checklistSectionSchema:
   - id: z.string()
   - name: z.string().min(1)
   - order: z.number()
   - items: z.array(checklistItemSchema)

3. inspectionTemplateSchema:
   - name: z.string().min(1)
   - description: z.string().optional()
   - tier: z.enum(['visual', 'functional', 'comprehensive', 'preventative'])
   - category: z.string().optional().nullable()
   - feature_type: z.string().optional().nullable()
   - equipment_category: z.string().optional().nullable()
   - sections: z.array(checklistSectionSchema)
   - estimated_minutes: z.number().optional()

4. Export types: ChecklistItemInput, ChecklistSectionInput, InspectionTemplateFormData
  </action>
  <verify>TypeScript compiles: `cd apps/admin && npm run build`</verify>
  <done>Template validation schemas created with all nested structures</done>
</task>

<task type="auto">
  <name>Task 2: Create template hooks</name>
  <files>apps/admin/src/hooks/use-inspection-templates.ts</files>
  <action>
Create React Query hooks for template operations:

1. useInspectionTemplates(options?: { tier?, category?, feature_type? }):
   - Query all templates with optional filters
   - Filter by is_active = true
   - Order by tier, category

2. useInspectionTemplate(id: string):
   - Query single template by ID
   - Enabled only when id is truthy

3. useCreateInspectionTemplate():
   - Mutation to insert new template
   - Set version = 1, is_current = true, is_active = true
   - Invalidate templates query on success

4. useUpdateInspectionTemplate():
   - Mutation to update template by id
   - Accept { id, data } where data is Partial<InspectionTemplateFormData>
   - Increment version
   - Invalidate queries on success

5. useDeleteInspectionTemplate():
   - Mutation to soft-delete (set is_active = false)
   - Invalidate queries on success

Follow existing hook patterns from use-equipment.ts and use-programs.ts.
  </action>
  <verify>TypeScript compiles: `cd apps/admin && npm run build`</verify>
  <done>Template CRUD hooks created with query invalidation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd apps/admin && npm run build` succeeds
- [ ] Validation schemas export correctly
- [ ] All hooks export correctly
</verification>

<success_criteria>
- All tasks completed
- No TypeScript errors
- Hooks ready for UI components
</success_criteria>

<output>
After completion, create `.planning/phases/05-templates-checklists/05-02-SUMMARY.md`
</output>
