---
phase: 05-templates-checklists
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - apps/admin/src/lib/checklist-generator.ts
  - apps/admin/src/hooks/use-checklist.ts
autonomous: true
---

<objective>
Create the checklist generation engine that produces dynamic checklists based on property profile, program tier, and equipment.

Purpose: Automatically generate comprehensive inspection checklists tailored to each property.
Output: Checklist generator function and React hook for generating/fetching checklists.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Prior plan output:
@.planning/phases/05-templates-checklists/05-01-SUMMARY.md

Reference document:
@C:/Users/Jake/Downloads/home-care-os-docs/phase-05-templates-checklists.md (section 5.3)

Property features (24 boolean flags):
@C:/Users/Jake/home-care-os/apps/admin/src/lib/validations/property.ts

Equipment hooks:
@C:/Users/Jake/home-care-os/apps/admin/src/hooks/use-equipment.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create checklist generator</name>
  <files>apps/admin/src/lib/checklist-generator.ts</files>
  <action>
Create checklist generation logic (client-side for now, can move to edge function later):

1. Import templates from constants/inspection-templates.ts
2. Import types from types/inspection.ts

3. Helper function getTiersToInclude(tier: string): string[]
   - Returns cumulative tiers (visual includes visual, functional includes visual+functional, etc.)

4. Helper function getCategoryLabel(category: string): string
   - Map category keys to display labels

5. Helper function calculateDuration(property, tier, itemCount): number
   - Base times per tier: visual=30, functional=60, comprehensive=120, preventative=180
   - Add time for square footage (per 1000 sqft)
   - Add time for features (pool, generator, dock)

6. Main function generateChecklist(params):
   - params: { property, program, equipment }
   - Returns GeneratedChecklist

   Logic:
   a. Get tiers to include based on program tier
   b. Add BASE_EXTERIOR_TEMPLATE items for included tiers
   c. Add BASE_INTERIOR_TEMPLATE items for included tiers
   d. If property has HVAC equipment:
      - Add HVAC_TEMPLATE items
      - Add equipment-specific items from equipment.inspection_checklist
   e. If property.features.pool:
      - Add POOL_TEMPLATE items
      - Add pool equipment-specific items
   f. If property.features.generator:
      - Add GENERATOR_TEMPLATE items
   g. Add remaining equipment categories (plumbing, electrical, kitchen, etc.)
   h. Calculate totals and estimated duration
   i. Return structured GeneratedChecklist

Follow exact structure from phase-05-templates-checklists.md section 5.3.
  </action>
  <verify>TypeScript compiles: `cd apps/admin && npm run build`</verify>
  <done>Checklist generator creates dynamic checklists based on property/program/equipment</done>
</task>

<task type="auto">
  <name>Task 2: Create checklist hook</name>
  <files>apps/admin/src/hooks/use-checklist.ts</files>
  <action>
Create React hooks for checklist operations:

1. useGenerateChecklist(propertyId, programId):
   - Fetches property (with equipment) and program
   - Calls generateChecklist() with fetched data
   - Returns GeneratedChecklist
   - queryKey: ['checklist', 'property', propertyId, 'program', programId]
   - Enabled only when both IDs are truthy

2. Import and use:
   - usePropertyEquipment from use-equipment.ts
   - usePropertyProgram from use-programs.ts
   - Or fetch directly in hook with supabase

3. The hook should:
   - Combine property data with equipment
   - Get program tier
   - Generate checklist
   - Cache result for reuse

Follow existing hook patterns.
  </action>
  <verify>TypeScript compiles: `cd apps/admin && npm run build`</verify>
  <done>Checklist hook generates and caches checklists</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd apps/admin && npm run build` succeeds
- [ ] Generator produces valid checklist structure
- [ ] Hook caches generated checklist
</verification>

<success_criteria>
- All tasks completed
- No TypeScript errors
- Checklist generation ready for UI
</success_criteria>

<output>
After completion, create `.planning/phases/05-templates-checklists/05-03-SUMMARY.md`
</output>
