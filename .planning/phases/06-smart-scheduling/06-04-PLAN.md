---
phase: 06-smart-scheduling
plan: 04
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - apps/admin/src/components/calendar/index.ts
  - apps/admin/src/components/calendar/calendar-view.tsx
  - apps/admin/src/components/calendar/calendar-header.tsx
  - apps/admin/src/components/calendar/calendar-grid.tsx
  - apps/admin/src/components/calendar/inspection-card.tsx
autonomous: true
must_haves:
  truths:
    - "Calendar displays month view with day cells"
    - "Navigation allows moving between months"
    - "Inspections appear in correct day cells"
    - "Inspection cards show property, time, and status"
  artifacts:
    - path: "apps/admin/src/components/calendar/calendar-view.tsx"
      provides: "Main calendar container with month navigation"
    - path: "apps/admin/src/components/calendar/calendar-grid.tsx"
      provides: "Grid of day cells for the month"
    - path: "apps/admin/src/components/calendar/inspection-card.tsx"
      provides: "Individual inspection display card"
  key_links:
    - from: "calendar-view.tsx"
      to: "calendar-grid.tsx"
      via: "passes currentDate and inspections props"
    - from: "calendar-grid.tsx"
      to: "inspection-card.tsx"
      via: "renders cards for each inspection in day"
---

<objective>
Create the calendar UI components for displaying the monthly view with inspections.

Purpose: Build the visual calendar grid that displays scheduled inspections.
Output: Reusable calendar components with month navigation and inspection cards.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan outputs
@.planning/phases/06-smart-scheduling/06-01-SUMMARY.md

# Types and constants from 06-01
@apps/admin/src/lib/types/scheduling.ts
@apps/admin/src/lib/constants/scheduling.ts

# Existing component patterns
@apps/admin/src/components/ui/button.tsx
@apps/admin/src/components/ui/card.tsx
@apps/admin/src/components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create inspection card component</name>
  <files>apps/admin/src/components/calendar/inspection-card.tsx</files>
  <action>
Create a compact card for displaying an inspection in the calendar:

```tsx
import { cn } from '@/lib/utils'
import { Badge } from '@/components/ui/badge'
import { Clock, MapPin, User } from 'lucide-react'
import type { CalendarInspection } from '@/lib/types/scheduling'
import { INSPECTION_STATUS_COLORS, INSPECTION_TYPES } from '@/lib/constants/scheduling'

interface InspectionCardProps {
  inspection: CalendarInspection
  onClick?: () => void
  compact?: boolean
}

export function InspectionCard({ inspection, onClick, compact = false }: InspectionCardProps) {
  const statusColor = INSPECTION_STATUS_COLORS[inspection.status || 'scheduled']
  const typeInfo = INSPECTION_TYPES.find(t => t.value === inspection.inspection_type)

  if (compact) {
    // Compact view for month calendar cells
    return (
      <button
        onClick={onClick}
        className={cn(
          'w-full text-left px-2 py-1 rounded text-xs truncate',
          'hover:opacity-80 transition-opacity',
          statusColor.bg,
          statusColor.text
        )}
      >
        <span className="font-medium">{inspection.scheduled_time_start?.slice(0, 5) || 'TBD'}</span>
        {' '}
        <span className="truncate">{inspection.property?.name || 'Unknown property'}</span>
      </button>
    )
  }

  // Full card view for day/week views or detail panels
  return (
    <div
      onClick={onClick}
      className={cn(
        'p-3 rounded-lg border cursor-pointer',
        'hover:shadow-md transition-shadow',
        'bg-card'
      )}
    >
      <div className="flex items-start justify-between gap-2 mb-2">
        <h4 className="font-medium text-sm truncate">
          {inspection.property?.name || 'Unknown property'}
        </h4>
        <Badge variant={statusColor.variant} className="shrink-0">
          {inspection.status || 'scheduled'}
        </Badge>
      </div>

      <div className="space-y-1 text-xs text-muted-foreground">
        {inspection.property?.address_line1 && (
          <div className="flex items-center gap-1">
            <MapPin className="h-3 w-3" />
            <span className="truncate">
              {inspection.property.address_line1}, {inspection.property.city}
            </span>
          </div>
        )}

        <div className="flex items-center gap-1">
          <Clock className="h-3 w-3" />
          <span>
            {inspection.scheduled_time_start?.slice(0, 5) || 'Time TBD'}
            {inspection.scheduled_time_end && ` - ${inspection.scheduled_time_end.slice(0, 5)}`}
          </span>
        </div>

        {inspection.inspector && (
          <div className="flex items-center gap-1">
            <User className="h-3 w-3" />
            <span>{inspection.inspector.full_name || inspection.inspector.email}</span>
          </div>
        )}
      </div>

      {typeInfo && (
        <div className="mt-2">
          <Badge variant="outline" className="text-xs">
            {typeInfo.label}
          </Badge>
        </div>
      )}
    </div>
  )
}
```

Use the INSPECTION_STATUS_COLORS from constants for status badges.
  </action>
  <verify>TypeScript compiles: cd apps/admin && npx tsc --noEmit</verify>
  <done>InspectionCard component renders inspection with property, time, status, and inspector</done>
</task>

<task type="auto">
  <name>Task 2: Create calendar grid and header</name>
  <files>apps/admin/src/components/calendar/calendar-header.tsx, apps/admin/src/components/calendar/calendar-grid.tsx</files>
  <action>
Create calendar-header.tsx:

```tsx
import { Button } from '@/components/ui/button'
import { ChevronLeft, ChevronRight, Calendar } from 'lucide-react'
import { format } from 'date-fns'

interface CalendarHeaderProps {
  currentDate: Date
  onPrevMonth: () => void
  onNextMonth: () => void
  onToday: () => void
}

export function CalendarHeader({
  currentDate,
  onPrevMonth,
  onNextMonth,
  onToday,
}: CalendarHeaderProps) {
  return (
    <div className="flex items-center justify-between mb-4">
      <h2 className="text-xl font-semibold">
        {format(currentDate, 'MMMM yyyy')}
      </h2>

      <div className="flex items-center gap-2">
        <Button variant="outline" size="sm" onClick={onToday}>
          <Calendar className="h-4 w-4 mr-1" />
          Today
        </Button>
        <div className="flex items-center">
          <Button variant="ghost" size="icon" onClick={onPrevMonth}>
            <ChevronLeft className="h-4 w-4" />
          </Button>
          <Button variant="ghost" size="icon" onClick={onNextMonth}>
            <ChevronRight className="h-4 w-4" />
          </Button>
        </div>
      </div>
    </div>
  )
}
```

Create calendar-grid.tsx:

```tsx
import { cn } from '@/lib/utils'
import {
  startOfMonth,
  endOfMonth,
  startOfWeek,
  endOfWeek,
  eachDayOfInterval,
  format,
  isSameMonth,
  isSameDay,
  isToday,
} from 'date-fns'
import type { CalendarInspection } from '@/lib/types/scheduling'
import { InspectionCard } from './inspection-card'

interface CalendarGridProps {
  currentDate: Date
  inspections: CalendarInspection[]
  onDayClick?: (date: Date) => void
  onInspectionClick?: (inspection: CalendarInspection) => void
}

const WEEKDAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']

export function CalendarGrid({
  currentDate,
  inspections,
  onDayClick,
  onInspectionClick,
}: CalendarGridProps) {
  // Get all days to display (includes days from prev/next month to fill grid)
  const monthStart = startOfMonth(currentDate)
  const monthEnd = endOfMonth(currentDate)
  const calendarStart = startOfWeek(monthStart)
  const calendarEnd = endOfWeek(monthEnd)
  const days = eachDayOfInterval({ start: calendarStart, end: calendarEnd })

  // Group inspections by date
  const inspectionsByDate = new Map<string, CalendarInspection[]>()
  for (const inspection of inspections) {
    const dateKey = inspection.scheduled_date
    const existing = inspectionsByDate.get(dateKey) || []
    existing.push(inspection)
    inspectionsByDate.set(dateKey, existing)
  }

  return (
    <div className="border rounded-lg overflow-hidden">
      {/* Weekday headers */}
      <div className="grid grid-cols-7 bg-muted">
        {WEEKDAYS.map((day) => (
          <div
            key={day}
            className="py-2 text-center text-sm font-medium text-muted-foreground"
          >
            {day}
          </div>
        ))}
      </div>

      {/* Day cells */}
      <div className="grid grid-cols-7">
        {days.map((day, index) => {
          const dateKey = format(day, 'yyyy-MM-dd')
          const dayInspections = inspectionsByDate.get(dateKey) || []
          const isCurrentMonth = isSameMonth(day, currentDate)

          return (
            <div
              key={index}
              onClick={() => onDayClick?.(day)}
              className={cn(
                'min-h-[100px] p-1 border-t border-l cursor-pointer',
                'hover:bg-muted/50 transition-colors',
                !isCurrentMonth && 'bg-muted/30'
              )}
            >
              {/* Day number */}
              <div
                className={cn(
                  'text-sm font-medium mb-1 w-7 h-7 flex items-center justify-center rounded-full',
                  isToday(day) && 'bg-primary text-primary-foreground',
                  !isCurrentMonth && 'text-muted-foreground'
                )}
              >
                {format(day, 'd')}
              </div>

              {/* Inspections */}
              <div className="space-y-1">
                {dayInspections.slice(0, 3).map((inspection) => (
                  <InspectionCard
                    key={inspection.id}
                    inspection={inspection}
                    compact
                    onClick={(e) => {
                      e?.stopPropagation?.()
                      onInspectionClick?.(inspection)
                    }}
                  />
                ))}
                {dayInspections.length > 3 && (
                  <div className="text-xs text-muted-foreground px-2">
                    +{dayInspections.length - 3} more
                  </div>
                )}
              </div>
            </div>
          )
        })}
      </div>
    </div>
  )
}
```

Use date-fns for all date calculations (already installed).
  </action>
  <verify>TypeScript compiles: cd apps/admin && npx tsc --noEmit</verify>
  <done>CalendarHeader and CalendarGrid components render month view with inspections</done>
</task>

<task type="auto">
  <name>Task 3: Create main calendar view and barrel export</name>
  <files>apps/admin/src/components/calendar/calendar-view.tsx, apps/admin/src/components/calendar/index.ts</files>
  <action>
Create calendar-view.tsx:

```tsx
import { useState, useMemo } from 'react'
import { addMonths, subMonths, startOfMonth, endOfMonth, format } from 'date-fns'
import { CalendarHeader } from './calendar-header'
import { CalendarGrid } from './calendar-grid'
import type { CalendarInspection } from '@/lib/types/scheduling'

interface CalendarViewProps {
  inspections: CalendarInspection[]
  isLoading?: boolean
  onDayClick?: (date: Date) => void
  onInspectionClick?: (inspection: CalendarInspection) => void
  onDateRangeChange?: (start: string, end: string) => void
}

export function CalendarView({
  inspections,
  isLoading,
  onDayClick,
  onInspectionClick,
  onDateRangeChange,
}: CalendarViewProps) {
  const [currentDate, setCurrentDate] = useState(new Date())

  // Notify parent of date range changes for data fetching
  useMemo(() => {
    const start = format(startOfMonth(currentDate), 'yyyy-MM-dd')
    const end = format(endOfMonth(currentDate), 'yyyy-MM-dd')
    onDateRangeChange?.(start, end)
  }, [currentDate, onDateRangeChange])

  const handlePrevMonth = () => {
    setCurrentDate((prev) => subMonths(prev, 1))
  }

  const handleNextMonth = () => {
    setCurrentDate((prev) => addMonths(prev, 1))
  }

  const handleToday = () => {
    setCurrentDate(new Date())
  }

  return (
    <div>
      <CalendarHeader
        currentDate={currentDate}
        onPrevMonth={handlePrevMonth}
        onNextMonth={handleNextMonth}
        onToday={handleToday}
      />

      {isLoading ? (
        <div className="border rounded-lg p-8 text-center text-muted-foreground">
          Loading inspections...
        </div>
      ) : (
        <CalendarGrid
          currentDate={currentDate}
          inspections={inspections}
          onDayClick={onDayClick}
          onInspectionClick={onInspectionClick}
        />
      )}
    </div>
  )
}
```

Create index.ts barrel export:

```ts
export { CalendarView } from './calendar-view'
export { CalendarHeader } from './calendar-header'
export { CalendarGrid } from './calendar-grid'
export { InspectionCard } from './inspection-card'
```
  </action>
  <verify>TypeScript compiles: cd apps/admin && npx tsc --noEmit</verify>
  <done>CalendarView component manages state and composes header/grid, barrel export created</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd apps/admin && npx tsc --noEmit` passes
- [ ] CalendarView renders month grid with navigation
- [ ] InspectionCard displays property name, time, and status
- [ ] CalendarGrid correctly groups inspections by date
- [ ] Today button navigates to current month
- [ ] Prev/next buttons change months
</verification>

<success_criteria>
- All tasks completed
- TypeScript compiles without errors
- Calendar displays correct days for each month
- Inspections appear in correct day cells
- Click handlers propagate correctly
</success_criteria>

<output>
After completion, create `.planning/phases/06-smart-scheduling/06-04-SUMMARY.md`
</output>
