---
phase: v1.4-04-pattern-templates
plan: 03
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - apps/admin/src/pages/portal/index.tsx
  - apps/admin/src/pages/portal/properties/index.tsx
  - apps/admin/src/pages/portal/inspections/index.tsx
  - apps/admin/src/pages/portal/requests/index.tsx
  - apps/admin/src/pages/portal/invoices/index.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Portal dashboard shows LoadingState during data fetch"
    - "Portal pages show ErrorState with retry when queries fail"
    - "Portal pages show EmptyState when no data exists"
    - "All portal list pages follow consistent 3-state pattern"
  artifacts:
    - path: "apps/admin/src/pages/portal/index.tsx"
      provides: "Portal dashboard with 3-state pattern"
      contains: "LoadingState|ErrorState"
    - path: "apps/admin/src/pages/portal/properties/index.tsx"
      provides: "Properties page with 3-state pattern"
      contains: "LoadingState|ErrorState|EmptyState"
    - path: "apps/admin/src/pages/portal/inspections/index.tsx"
      provides: "Inspections page with 3-state pattern"
      contains: "LoadingState|ErrorState|EmptyState"
    - path: "apps/admin/src/pages/portal/requests/index.tsx"
      provides: "Requests page with 3-state pattern"
      contains: "LoadingState|ErrorState|EmptyState"
    - path: "apps/admin/src/pages/portal/invoices/index.tsx"
      provides: "Invoices page with 3-state pattern"
      contains: "LoadingState|ErrorState|EmptyState"
  key_links:
    - from: "apps/admin/src/pages/portal/properties/index.tsx"
      to: "@/components/shared"
      via: "import shared components"
      pattern: "import.*from.*@/components/shared"
---

<objective>
Apply the 3-state pattern (loading/error/empty) to all portal pages using the new shared components.

Purpose: Implement SYNC-08.4 (Apply 3-state pattern to all portal pages) ensuring consistent user experience across the client portal.

Output: All 5 portal list pages updated with proper loading, error, and empty states.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS-v1.4.md

Reference plan 04-02 outputs:
@apps/admin/src/components/shared/loading-state.tsx
@apps/admin/src/components/shared/error-state.tsx
@apps/admin/src/components/shared/empty-state.tsx
@apps/admin/src/components/shared/index.ts

Current portal pages to update:
@apps/admin/src/pages/portal/index.tsx
@apps/admin/src/pages/portal/properties/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Portal Properties page (SYNC-08.4)</name>
  <files>apps/admin/src/pages/portal/properties/index.tsx</files>
  <action>
Update `src/pages/portal/properties/index.tsx` to use the 3-state pattern.

Current code uses inline loading skeleton and basic empty state. Replace with shared components:

```typescript
import { Home } from 'lucide-react'
import { PropertyCard } from '@/components/portal/property-card'
import { LoadingState, ErrorState, EmptyState } from '@/components/shared'
import { usePortalProperties } from '@/hooks/use-portal-dashboard'

export default function PortalPropertiesPage() {
  const { data: properties, isLoading, error, refetch } = usePortalProperties()

  // Loading state
  if (isLoading) {
    return <LoadingState message="Loading your properties..." />
  }

  // Error state
  if (error) {
    return (
      <ErrorState
        title="Failed to load properties"
        error={error}
        onRetry={() => refetch()}
      />
    )
  }

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-semibold text-gray-900">Your Properties</h1>
        <p className="text-gray-500">
          View and manage all your properties under our care
        </p>
      </div>

      {/* Empty state */}
      {!properties?.length ? (
        <EmptyState
          icon={Home}
          title="No properties found"
          description="No properties have been assigned to your account yet. Contact your property manager to get started."
        />
      ) : (
        <div className="grid md:grid-cols-2 gap-4">
          {properties.map((property) => (
            <PropertyCard key={property.id} property={property} />
          ))}
        </div>
      )}
    </div>
  )
}
```

Key changes:
- Import LoadingState, ErrorState, EmptyState from @/components/shared
- Add `error` and `refetch` from usePortalProperties hook
- Replace Skeleton loading with LoadingState
- Add ErrorState with retry button
- Replace inline empty div with EmptyState component
  </action>
  <verify>
- File updated at apps/admin/src/pages/portal/properties/index.tsx
- Contains import from '@/components/shared'
- Contains LoadingState, ErrorState, EmptyState usage
- TypeScript compiles: `cd apps/admin && npx tsc --noEmit`
  </verify>
  <done>Properties page uses 3-state pattern with shared components</done>
</task>

<task type="auto">
  <name>Task 2: Update Portal Inspections page (SYNC-08.4)</name>
  <files>apps/admin/src/pages/portal/inspections/index.tsx</files>
  <action>
Read the current file first, then update `src/pages/portal/inspections/index.tsx` to use 3-state pattern.

Pattern to apply:
1. Import { LoadingState, ErrorState, EmptyState } from '@/components/shared'
2. Get error and refetch from the hook: `const { data, isLoading, error, refetch } = usePortalInspections()`
3. Add loading state check: `if (isLoading) return <LoadingState message="Loading inspections..." />`
4. Add error state check: `if (error) return <ErrorState error={error} onRetry={() => refetch()} />`
5. Replace any inline empty state with EmptyState component using ClipboardCheck icon

Example structure:
```typescript
import { ClipboardCheck } from 'lucide-react'
import { LoadingState, ErrorState, EmptyState } from '@/components/shared'

export default function PortalInspectionsPage() {
  const { data: inspections, isLoading, error, refetch } = usePortalInspections()

  if (isLoading) {
    return <LoadingState message="Loading inspections..." />
  }

  if (error) {
    return <ErrorState title="Failed to load inspections" error={error} onRetry={() => refetch()} />
  }

  // ... rest of component with EmptyState for empty data
}
```
  </action>
  <verify>
- File updated at apps/admin/src/pages/portal/inspections/index.tsx
- Contains LoadingState, ErrorState usage
- TypeScript compiles: `cd apps/admin && npx tsc --noEmit`
  </verify>
  <done>Inspections page uses 3-state pattern with shared components</done>
</task>

<task type="auto">
  <name>Task 3: Update Portal Requests page (SYNC-08.4)</name>
  <files>apps/admin/src/pages/portal/requests/index.tsx</files>
  <action>
Read the current file first, then update `src/pages/portal/requests/index.tsx` to use 3-state pattern.

Pattern to apply:
1. Import { LoadingState, ErrorState, EmptyState } from '@/components/shared'
2. Get error and refetch from the hook
3. Add loading state check with message "Loading service requests..."
4. Add error state check with retry
5. Replace any inline empty state with EmptyState component using MessageSquare or FileText icon

Keep any existing "New Request" button in the EmptyState action slot.
  </action>
  <verify>
- File updated at apps/admin/src/pages/portal/requests/index.tsx
- Contains LoadingState, ErrorState usage
- TypeScript compiles: `cd apps/admin && npx tsc --noEmit`
  </verify>
  <done>Requests page uses 3-state pattern with shared components</done>
</task>

<task type="auto">
  <name>Task 4: Update Portal Invoices page (SYNC-08.4)</name>
  <files>apps/admin/src/pages/portal/invoices/index.tsx</files>
  <action>
Read the current file first, then update `src/pages/portal/invoices/index.tsx` to use 3-state pattern.

Pattern to apply:
1. Import { LoadingState, ErrorState, EmptyState } from '@/components/shared'
2. Get error and refetch from the hook
3. Add loading state check with message "Loading invoices..."
4. Add error state check with retry
5. Replace any inline empty state with EmptyState component using Receipt icon
  </action>
  <verify>
- File updated at apps/admin/src/pages/portal/invoices/index.tsx
- Contains LoadingState, ErrorState usage
- TypeScript compiles: `cd apps/admin && npx tsc --noEmit`
  </verify>
  <done>Invoices page uses 3-state pattern with shared components</done>
</task>

<task type="auto">
  <name>Task 5: Update Portal Dashboard page (SYNC-08.4)</name>
  <files>apps/admin/src/pages/portal/index.tsx</files>
  <action>
Read the current file first, then update `src/pages/portal/index.tsx` to add error handling.

The dashboard already has some loading handling but lacks error state. Update to:

1. Import { LoadingState, ErrorState } from '@/components/shared'
2. Add error state check for the main data hooks (summary and properties)
3. Show ErrorState when critical data fails to load

Note: Dashboard is more complex with multiple data sources. Focus on adding error handling for the primary data (summary), while keeping individual section loading as-is.

Example:
```typescript
const { data: summary, isLoading: summaryLoading, error: summaryError, refetch: refetchSummary } = usePortalDashboard()

// Show error if main dashboard data fails
if (summaryError) {
  return <ErrorState title="Failed to load dashboard" error={summaryError} onRetry={() => refetchSummary()} />
}
```
  </action>
  <verify>
- File updated at apps/admin/src/pages/portal/index.tsx
- Contains ErrorState import and usage
- TypeScript compiles: `cd apps/admin && npx tsc --noEmit`
  </verify>
  <done>Portal dashboard has error handling with retry</done>
</task>

</tasks>

<verification>
Run these commands to verify plan completion:

```bash
# 1. Verify files updated
grep -l "LoadingState\|ErrorState" apps/admin/src/pages/portal/*.tsx
grep -l "LoadingState\|ErrorState" apps/admin/src/pages/portal/*/*.tsx

# 2. Verify imports from shared
grep "@/components/shared" apps/admin/src/pages/portal/properties/index.tsx
grep "@/components/shared" apps/admin/src/pages/portal/inspections/index.tsx

# 3. TypeScript compiles
cd apps/admin && npx tsc --noEmit

# 4. Production build
cd apps/admin && npm run build
```
</verification>

<success_criteria>
- [ ] Portal properties page uses LoadingState, ErrorState, EmptyState
- [ ] Portal inspections page uses LoadingState, ErrorState, EmptyState
- [ ] Portal requests page uses LoadingState, ErrorState, EmptyState
- [ ] Portal invoices page uses LoadingState, ErrorState, EmptyState
- [ ] Portal dashboard has error handling with retry
- [ ] TypeScript compiles without errors
- [ ] Production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/v1.4-04-pattern-templates/04-03-SUMMARY.md`
</output>
