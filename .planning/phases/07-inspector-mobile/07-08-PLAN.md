---
phase: 07-inspector-mobile
plan: 08
type: execute
wave: 4
depends_on: ["07-06", "07-07"]
files_modified:
  - apps/admin/src/pages/inspector/index.tsx
  - apps/admin/src/pages/inspector/inspection.tsx
  - apps/admin/src/App.tsx
autonomous: true
checkpoint: true
must_haves:
  truths:
    - "Inspector dashboard shows today's schedule"
    - "Inspection page allows full execution workflow"
    - "Routes are protected for inspector role"
  artifacts:
    - path: "apps/admin/src/pages/inspector/index.tsx"
      provides: "Inspector dashboard page"
    - path: "apps/admin/src/pages/inspector/inspection.tsx"
      provides: "Inspection execution page"
  key_links:
    - from: "App.tsx"
      to: "pages/inspector/*.tsx"
      via: "React Router routes"
    - from: "inspection.tsx"
      to: "all inspector components"
      via: "imports and composition"
---

<objective>
Create inspector pages and integrate all components into working workflow.

Purpose: Provide complete inspector mobile experience.
Output: Fully functional inspector dashboard and inspection execution pages.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan outputs
@.planning/phases/07-inspector-mobile/07-06-SUMMARY.md
@.planning/phases/07-inspector-mobile/07-07-SUMMARY.md

# All inspector components
@apps/admin/src/components/inspector/*.tsx
@apps/admin/src/hooks/use-inspector-schedule.ts
@apps/admin/src/hooks/use-inspection-execution.ts

# Current App.tsx for routing
@apps/admin/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create inspector dashboard page</name>
  <files>apps/admin/src/pages/inspector/index.tsx</files>
  <action>
Create apps/admin/src/pages/inspector/index.tsx:

```tsx
import { useState } from 'react'
import { format, addDays, subDays } from 'date-fns'
import { ChevronLeft, ChevronRight, Calendar, RefreshCw } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { ScheduleList } from '@/components/inspector/schedule-list'
import { SyncStatus } from '@/components/inspector/sync-status'
import { useOfflineStatus, useManualSync } from '@/hooks/use-offline'
import { useInspectorUpcoming } from '@/hooks/use-inspector-schedule'
import { registerPWA, updateServiceWorker } from '@/lib/pwa'
import { useEffect, useState as useStateReact } from 'react'

export default function InspectorDashboard() {
  const [selectedDate, setSelectedDate] = useState(
    format(new Date(), 'yyyy-MM-dd')
  )
  const { isOnline } = useOfflineStatus()
  const manualSync = useManualSync()
  const { data: upcoming } = useInspectorUpcoming()

  // PWA update state
  const [needsUpdate, setNeedsUpdate] = useStateReact(false)

  useEffect(() => {
    registerPWA(
      () => setNeedsUpdate(true),
      () => console.log('App ready for offline use')
    )
  }, [])

  const handlePrevDay = () => {
    setSelectedDate(format(subDays(new Date(selectedDate), 1), 'yyyy-MM-dd'))
  }

  const handleNextDay = () => {
    setSelectedDate(format(addDays(new Date(selectedDate), 1), 'yyyy-MM-dd'))
  }

  const handleToday = () => {
    setSelectedDate(format(new Date(), 'yyyy-MM-dd'))
  }

  const isToday = selectedDate === format(new Date(), 'yyyy-MM-dd')

  return (
    <div className="min-h-screen bg-background flex flex-col">
      {/* PWA Update Banner */}
      {needsUpdate && (
        <div className="bg-rb-green text-white p-3 flex items-center justify-between">
          <span className="text-sm">A new version is available!</span>
          <Button
            size="sm"
            variant="secondary"
            onClick={() => updateServiceWorker(true)}
          >
            Update
          </Button>
        </div>
      )}

      {/* Header */}
      <header className="bg-rb-green text-white p-4">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-xl font-semibold">Inspector</h1>
            <p className="text-sm text-white/80">Ross Built Home Care</p>
          </div>
          <div className="flex items-center gap-2">
            {isOnline && (
              <Button
                variant="ghost"
                size="icon"
                className="text-white hover:bg-white/20"
                onClick={() => manualSync.mutate()}
                disabled={manualSync.isPending}
              >
                <RefreshCw
                  className={`h-5 w-5 ${manualSync.isPending ? 'animate-spin' : ''}`}
                />
              </Button>
            )}
          </div>
        </div>
      </header>

      {/* Date Navigation */}
      <div className="border-b bg-muted/30">
        <div className="flex items-center justify-between p-3">
          <Button variant="ghost" size="icon" onClick={handlePrevDay}>
            <ChevronLeft className="h-5 w-5" />
          </Button>

          <button
            onClick={handleToday}
            className="flex items-center gap-2 px-3 py-1.5 rounded-lg hover:bg-muted"
          >
            <Calendar className="h-4 w-4" />
            <span className="font-medium">
              {isToday
                ? 'Today'
                : format(new Date(selectedDate), 'EEE, MMM d')}
            </span>
          </button>

          <Button variant="ghost" size="icon" onClick={handleNextDay}>
            <ChevronRight className="h-5 w-5" />
          </Button>
        </div>
      </div>

      {/* Schedule List */}
      <div className="flex-1 overflow-y-auto">
        <ScheduleList date={selectedDate} />
      </div>

      {/* Bottom Sync Status */}
      <div className="border-t p-4">
        <SyncStatus compact />

        {/* Upcoming count */}
        {upcoming && upcoming.length > 0 && (
          <p className="text-xs text-muted-foreground mt-2 text-center">
            {upcoming.length} inspection{upcoming.length > 1 ? 's' : ''} in the
            next 7 days
          </p>
        )}
      </div>
    </div>
  )
}
```
  </action>
  <verify>TypeScript compiles: cd apps/admin && npx tsc --noEmit</verify>
  <done>Inspector dashboard with date navigation and schedule</done>
</task>

<task type="auto">
  <name>Task 2: Create inspection execution page</name>
  <files>apps/admin/src/pages/inspector/inspection.tsx</files>
  <action>
Create apps/admin/src/pages/inspector/inspection.tsx:

```tsx
import { useState } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { Play, CheckCircle2, Loader2 } from 'lucide-react'
import { Button } from '@/components/ui/button'
import { InspectionHeader } from '@/components/inspector/inspection-header'
import { InspectionChecklist } from '@/components/inspector/inspection-checklist'
import { CompletionForm } from '@/components/inspector/completion-form'
import { useInspectorInspection } from '@/hooks/use-inspector-schedule'
import {
  useStartInspection,
  calculateInspectionProgress,
} from '@/hooks/use-inspection-execution'

export default function InspectionPage() {
  const { id } = useParams<{ id: string }>()
  const navigate = useNavigate()
  const { data: inspection, isLoading, error } = useInspectorInspection(id)
  const startInspection = useStartInspection()
  const [showCompletion, setShowCompletion] = useState(false)

  if (isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin text-rb-green" />
      </div>
    )
  }

  if (error || !inspection) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center p-4">
        <p className="text-lg font-medium text-destructive">
          Inspection not found
        </p>
        <Button
          variant="outline"
          onClick={() => navigate('/inspector')}
          className="mt-4"
        >
          Back to Schedule
        </Button>
      </div>
    )
  }

  const isScheduled = inspection.status === 'scheduled'
  const isInProgress = inspection.status === 'in_progress'
  const progress = calculateInspectionProgress(inspection)

  const handleStart = async () => {
    await startInspection.mutateAsync(inspection.id)
  }

  return (
    <div className="min-h-screen bg-background flex flex-col">
      {/* Header with property info and progress */}
      <InspectionHeader inspection={inspection} />

      {/* Main content */}
      <div className="flex-1 flex flex-col overflow-hidden">
        {isScheduled ? (
          // Start inspection screen
          <div className="flex-1 flex flex-col items-center justify-center p-8">
            <div className="text-center max-w-sm">
              <div className="w-16 h-16 rounded-full bg-rb-green/10 flex items-center justify-center mx-auto mb-4">
                <Play className="h-8 w-8 text-rb-green" />
              </div>
              <h2 className="text-xl font-semibold mb-2">Ready to Begin</h2>
              <p className="text-muted-foreground mb-6">
                Start the inspection to begin recording findings for{' '}
                {inspection.checklist?.sections?.reduce(
                  (acc, s) => acc + s.items.length,
                  0
                ) || 0}{' '}
                checklist items.
              </p>

              {/* Property access info */}
              {inspection.property?.access_codes && (
                <div className="bg-muted rounded-lg p-4 mb-6 text-left">
                  <p className="text-sm font-medium mb-2">Access Information</p>
                  {Object.entries(inspection.property.access_codes).map(
                    ([key, value]) => (
                      <p key={key} className="text-sm">
                        <span className="text-muted-foreground">{key}:</span>{' '}
                        <span className="font-mono">{value}</span>
                      </p>
                    )
                  )}
                </div>
              )}

              {/* Special instructions */}
              {inspection.property?.special_instructions && (
                <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 text-left">
                  <p className="text-sm font-medium text-yellow-800 mb-1">
                    Special Instructions
                  </p>
                  <p className="text-sm text-yellow-700">
                    {inspection.property.special_instructions}
                  </p>
                </div>
              )}

              <Button
                onClick={handleStart}
                disabled={startInspection.isPending}
                className="w-full bg-rb-green hover:bg-rb-green/90"
                size="lg"
              >
                {startInspection.isPending ? (
                  <Loader2 className="h-4 w-4 animate-spin mr-2" />
                ) : (
                  <Play className="h-4 w-4 mr-2" />
                )}
                Start Inspection
              </Button>
            </div>
          </div>
        ) : isInProgress ? (
          // Checklist view
          <>
            <div className="flex-1 overflow-hidden">
              <InspectionChecklist inspection={inspection} />
            </div>

            {/* Complete button */}
            <div className="border-t p-4">
              <Button
                onClick={() => setShowCompletion(true)}
                disabled={progress.completed === 0}
                className="w-full bg-rb-green hover:bg-rb-green/90"
                size="lg"
              >
                <CheckCircle2 className="h-4 w-4 mr-2" />
                Complete Inspection ({progress.percentage}%)
              </Button>
            </div>

            {/* Completion form sheet */}
            <CompletionForm
              inspection={inspection}
              open={showCompletion}
              onOpenChange={setShowCompletion}
            />
          </>
        ) : (
          // Completed state
          <div className="flex-1 flex flex-col items-center justify-center p-8">
            <CheckCircle2 className="h-16 w-16 text-green-600 mb-4" />
            <h2 className="text-xl font-semibold mb-2">Inspection Complete</h2>
            <p className="text-muted-foreground mb-6 text-center">
              This inspection has been completed and submitted.
            </p>
            <Button
              variant="outline"
              onClick={() => navigate('/inspector')}
            >
              Back to Schedule
            </Button>
          </div>
        )}
      </div>
    </div>
  )
}
```
  </action>
  <verify>TypeScript compiles: cd apps/admin && npx tsc --noEmit</verify>
  <done>Inspection execution page with start, checklist, and complete</done>
</task>

<task type="auto">
  <name>Task 3: Add inspector routes to App.tsx</name>
  <files>apps/admin/src/App.tsx</files>
  <action>
Update apps/admin/src/App.tsx to add inspector routes.

Add imports at top:
```tsx
import InspectorDashboard from '@/pages/inspector'
import InspectionPage from '@/pages/inspector/inspection'
```

Add routes inside the Routes component (within authenticated routes):
```tsx
{/* Inspector Routes */}
<Route path="/inspector" element={<InspectorDashboard />} />
<Route path="/inspector/inspection/:id" element={<InspectionPage />} />
```

Note: Place these routes within the authenticated section (inside PrivateRoute wrapper if used), but they should be accessible without the main admin layout since inspector mobile is a separate experience.
  </action>
  <verify>TypeScript compiles and routes work: cd apps/admin && npx tsc --noEmit</verify>
  <done>Inspector routes added to application</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd apps/admin && npx tsc --noEmit` passes
- [ ] /inspector route shows dashboard
- [ ] /inspector/inspection/:id loads inspection
- [ ] Start inspection updates status
- [ ] Checklist navigation works
- [ ] Complete flow submits inspection
</verification>

<success_criteria>
- All tasks completed
- TypeScript compiles without errors
- Inspector dashboard loads schedule
- Inspection page handles all states
- Full workflow: start → record → complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-inspector-mobile/07-08-SUMMARY.md`
</output>
