---
phase: 14-testing-launch
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - apps/admin/.env.production
  - .planning/phases/14-testing-launch/DEPLOYMENT.md
autonomous: true
user_setup:
  - service: supabase
    why: "Production environment requires API keys"
    env_vars:
      - name: VITE_SUPABASE_URL
        source: "Supabase Dashboard → Project Settings → API → Project URL"
      - name: VITE_SUPABASE_ANON_KEY
        source: "Supabase Dashboard → Project Settings → API → anon public key"
    dashboard_config:
      - task: "Verify RLS policies are enabled"
        location: "Supabase Dashboard → Authentication → Policies"
        details: "Ensure all tables have RLS enabled for production security"
  - service: vercel
    why: "Deployment platform for the admin app"
    env_vars:
      - name: VITE_SUPABASE_URL
        source: "Same as above - add to Vercel Environment Variables"
      - name: VITE_SUPABASE_ANON_KEY
        source: "Same as above - add to Vercel Environment Variables"
---

<objective>
Document production environment configuration and prepare deployment checklist.

Purpose: Ensure all environment variables and configurations are documented for deployment.
Output: Production environment documentation and deployment checklist.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Prior plan output:
@.planning/phases/14-testing-launch/14-01-SUMMARY.md

Existing setup docs:
@C:/Users/Jake/home-care-os/apps/admin/src/lib/stripe/STRIPE_SETUP.md
@C:/Users/Jake/home-care-os/apps/admin/src/lib/email/RESEND_SETUP.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create production environment template</name>
  <files>apps/admin/.env.production.example</files>
  <action>
Create a production environment template file documenting all required variables:

```env
# Supabase Configuration
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key

# Note: The following are configured in Supabase Edge Function secrets:
# - ANTHROPIC_API_KEY (for AI features)
# - STRIPE_SECRET_KEY (for payment processing)
# - STRIPE_WEBHOOK_SECRET (for Stripe webhooks)
# - RESEND_API_KEY (for email notifications)
```

This file serves as documentation - actual values go in Vercel environment variables.
  </action>
  <verify>File exists at apps/admin/.env.production.example</verify>
  <done>.env.production.example created with all required variables documented</done>
</task>

<task type="auto">
  <name>Task 2: Create deployment documentation</name>
  <files>.planning/phases/14-testing-launch/DEPLOYMENT.md</files>
  <action>
Create comprehensive deployment documentation:

# Home Care OS Deployment Guide

## Prerequisites

1. **Supabase Project** (already configured: rossbuilt-homecare)
2. **Vercel Account** (for hosting)
3. **Domain** (optional: for custom domain)

## Environment Variables

### Vercel (Admin App)
| Variable | Source | Required |
|----------|--------|----------|
| VITE_SUPABASE_URL | Supabase Dashboard → API | Yes |
| VITE_SUPABASE_ANON_KEY | Supabase Dashboard → API | Yes |

### Supabase Edge Function Secrets
| Secret | Source | Used By |
|--------|--------|---------|
| ANTHROPIC_API_KEY | Anthropic Console | generate-equipment-maintenance, generate-report-summary |
| STRIPE_SECRET_KEY | Stripe Dashboard | create-payment-link, stripe-webhook |
| STRIPE_WEBHOOK_SECRET | Stripe Dashboard | stripe-webhook |
| RESEND_API_KEY | Resend Dashboard | send-email |

## Deployment Steps

### 1. Deploy Admin App to Vercel
```bash
cd apps/admin
vercel --yes
```

### 2. Configure Environment Variables
In Vercel Dashboard → Settings → Environment Variables:
- Add VITE_SUPABASE_URL
- Add VITE_SUPABASE_ANON_KEY

### 3. Deploy Edge Functions
```bash
cd supabase
supabase functions deploy generate-equipment-maintenance
supabase functions deploy generate-report-summary
supabase functions deploy create-payment-link
supabase functions deploy stripe-webhook
supabase functions deploy send-email
```

### 4. Set Edge Function Secrets
```bash
supabase secrets set ANTHROPIC_API_KEY=your-key
supabase secrets set STRIPE_SECRET_KEY=your-key
supabase secrets set STRIPE_WEBHOOK_SECRET=your-key
supabase secrets set RESEND_API_KEY=your-key
```

## Post-Deployment Verification
- [ ] Admin app loads at Vercel URL
- [ ] Login works with test user
- [ ] Dashboard shows data
- [ ] AI features work (equipment maintenance generation)
- [ ] Email notifications send
- [ ] Stripe payment links generate

## Rollback
```bash
vercel rollback  # Reverts to previous deployment
```
  </action>
  <verify>DEPLOYMENT.md exists with complete deployment instructions</verify>
  <done>Deployment documentation created with all steps and configuration</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] .env.production.example created
- [ ] DEPLOYMENT.md created with complete instructions
- [ ] All environment variables documented
- [ ] Edge function deployment commands documented
</verification>

<success_criteria>
- All tasks completed
- Complete deployment documentation
- Clear step-by-step instructions
</success_criteria>

<output>
After completion, create `.planning/phases/14-testing-launch/14-02-SUMMARY.md`
</output>
