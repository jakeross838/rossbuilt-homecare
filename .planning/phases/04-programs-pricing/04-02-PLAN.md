---
phase: 04-programs-pricing
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - apps/admin/src/hooks/use-pricing.ts
  - apps/admin/src/hooks/use-programs.ts
autonomous: true
---

<objective>
Create React Query hooks for pricing configuration and program CRUD operations.

Purpose: Provide data fetching and mutation capabilities for programs and pricing.
Output: Pricing hooks with calculate function; Program hooks with full lifecycle management.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Prior plan output:
@.planning/phases/04-programs-pricing/04-01-SUMMARY.md

Reference document:
@C:/Users/Jake/Downloads/home-care-os-docs/phase-04-programs-pricing.md (sections 4.4-4.5)

Existing hook patterns:
@C:/Users/Jake/home-care-os/apps/admin/src/hooks/use-equipment.ts
@C:/Users/Jake/home-care-os/apps/admin/src/hooks/use-clients.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pricing hooks</name>
  <files>apps/admin/src/hooks/use-pricing.ts</files>
  <action>
Create pricing-related hooks:

1. usePricingConfig hook:
   - useQuery with queryKey ['pricing-config']
   - Fetch from pricing_config table where is_current = true
   - Return single record typed as PricingConfig & { id: string }

2. useUpdatePricingConfig mutation:
   - Mark current config as is_current = false
   - Insert new config with incremented version
   - Set effective_date to current date
   - Invalidate ['pricing-config'] on success

3. calculateProgramPrice function (not a hook, pure function):
   - Takes config, frequency, tier, addons object
   - Returns { baseFee, tierFee, addonsFee, monthlyTotal }
   - Look up prices from config objects by key

Import from:
- @tanstack/react-query
- @/lib/supabase
- @/lib/validations/pricing

Follow exact structure from phase-04-programs-pricing.md section 4.4.
  </action>
  <verify>TypeScript compiles: `cd apps/admin && npm run build`</verify>
  <done>Pricing hooks created with query, mutation, and calculate function</done>
</task>

<task type="auto">
  <name>Task 2: Create program hooks</name>
  <files>apps/admin/src/hooks/use-programs.ts</files>
  <action>
Create program CRUD hooks:

1. usePropertyProgram(propertyId) query:
   - Fetch active/pending/paused program for property
   - Order by created_at desc, limit 1
   - Handle PGRST116 (no rows) error gracefully
   - Enabled only when propertyId is truthy

2. useCreateProgram mutation:
   - Insert program with status='active', activated_at=now()
   - Accepts ProgramFormData plus calculated fees
   - Invalidate program and property queries on success

3. useUpdateProgram mutation:
   - Update program by id
   - Accepts { id, data: Partial<ProgramFormData> }
   - Invalidate program query on success

4. usePauseProgram mutation:
   - Update status='paused', paused_at=now()
   - Takes program id
   - Invalidate on success

5. useResumeProgram mutation:
   - Update status='active', paused_at=null
   - Takes program id
   - Invalidate on success

6. useCancelProgram mutation:
   - Update status='cancelled', cancelled_at=now()
   - Takes program id
   - Invalidate on success

Import from:
- @tanstack/react-query
- @/lib/supabase
- @/lib/validations/program

Follow exact structure from phase-04-programs-pricing.md section 4.5.
  </action>
  <verify>TypeScript compiles: `cd apps/admin && npm run build`</verify>
  <done>Program hooks created with full CRUD and lifecycle management</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd apps/admin && npm run build` succeeds
- [ ] usePricingConfig returns typed config
- [ ] calculateProgramPrice returns correct structure
- [ ] All program lifecycle hooks export correctly
</verification>

<success_criteria>
- All tasks completed
- No TypeScript errors
- Hooks ready for UI components
</success_criteria>

<output>
After completion, create `.planning/phases/04-programs-pricing/04-02-SUMMARY.md`
</output>
