---
phase: 04-programs-pricing
plan: 05
type: execute
wave: 4
depends_on: ["04-03", "04-04"]
files_modified:
  - apps/admin/src/pages/settings/pricing.tsx
  - apps/admin/src/pages/properties/[id]/index.tsx
  - apps/admin/src/App.tsx
autonomous: true
---

<objective>
Create Pricing Settings page and integrate program components into property pages.

Purpose: Complete the programs & pricing feature with admin settings and property integration.
Output: Settings page for pricing config; Property pages show program builder or status card.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Prior plan outputs:
@.planning/phases/04-programs-pricing/04-01-SUMMARY.md
@.planning/phases/04-programs-pricing/04-02-SUMMARY.md
@.planning/phases/04-programs-pricing/04-03-SUMMARY.md
@.planning/phases/04-programs-pricing/04-04-SUMMARY.md

Reference document:
@C:/Users/Jake/Downloads/home-care-os-docs/phase-04-programs-pricing.md (section 4.8)

Property detail page:
@C:/Users/Jake/home-care-os/apps/admin/src/pages/properties/[id]/index.tsx

Router:
@C:/Users/Jake/home-care-os/apps/admin/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Pricing Settings page</name>
  <files>apps/admin/src/pages/settings/pricing.tsx</files>
  <action>
Create Pricing Settings page:

1. Use react-hook-form with pricingConfigSchema

2. Fetch current config with usePricingConfig

3. Reset form when config loads (useEffect)

4. Page layout:
   - PageHeader: "Pricing Configuration" / "Configure program pricing and service rates"

5. Form with 4 Cards:

   Card 1 - Frequency Pricing:
   - Title: "Inspection Frequency Base Pricing"
   - 5-column grid: annual, semi_annual, quarterly, monthly, bi_weekly
   - Each input has $ prefix

   Card 2 - Tier Pricing:
   - Title: "Inspection Tier Pricing"
   - 4-column grid: visual, functional, comprehensive, preventative
   - Each input has $ prefix

   Card 3 - Add-on Pricing:
   - Title: "Add-On Pricing"
   - 4-column grid: digital_manual, warranty_tracking, emergency_response, hurricane_monitoring
   - Each input has $ prefix

   Card 4 - Service Rates:
   - Title: "Service Rates"
   - 4-column grid: hourly_rate, pre_storm_prep, post_storm_inspection, vendor_markup_percent
   - hourly/storm inputs have $ prefix, markup has % suffix

6. Submit section:
   - Reset button (variant outline, calls reset())
   - Save Changes button (disabled if !isDirty or isPending)

7. onSubmit: Call updateConfig.mutateAsync, toast success/error

Follow exact structure from phase-04-programs-pricing.md section 4.8.
  </action>
  <verify>TypeScript compiles: `cd apps/admin && npm run build`</verify>
  <done>Pricing Settings page created with all configuration sections</done>
</task>

<task type="auto">
  <name>Task 2: Add route for Pricing Settings</name>
  <files>apps/admin/src/App.tsx</files>
  <action>
Add route for Pricing Settings page:

1. Import PricingSettingsPage from '@/pages/settings/pricing'

2. Add route under authenticated routes:
   - Path: /settings/pricing
   - Element: <PricingSettingsPage />

3. Add navigation link in sidebar (if not already present):
   - Under Settings section
   - Label: "Pricing"
   - Icon: DollarSign
  </action>
  <verify>Route accessible at /settings/pricing</verify>
  <done>Pricing settings route added to router</done>
</task>

<task type="auto">
  <name>Task 3: Integrate program components into property page</name>
  <files>apps/admin/src/pages/properties/[id]/index.tsx</files>
  <action>
Add program section to property detail page:

1. Import from '@/components/programs':
   - ProgramBuilder
   - ProgramStatusCard

2. Import usePropertyProgram from '@/hooks/use-programs'

3. Fetch program for this property using usePropertyProgram(propertyId)

4. Add Program section after Equipment section:
   - Section heading: "Home Care Program"
   - Conditional rendering:
     - If program exists and status is active/pending/paused: Show ProgramStatusCard
     - Otherwise: Show ProgramBuilder

5. ProgramBuilder props:
   - propertyId from route params
   - clientId from property.client_id
   - propertyName from property.name or property.address_street
   - onSuccess: Could show toast or switch to status card view

6. ProgramStatusCard props:
   - propertyId from route params
   - onEdit: Optional handler to open edit mode

7. Layout considerations:
   - Full-width section below equipment
   - Consistent spacing with rest of page
  </action>
  <verify>TypeScript compiles and property page shows program section</verify>
  <done>Program components integrated into property detail page</done>
</task>

<task type="auto">
  <name>Task 4: End-to-end testing</name>
  <files>apps/admin/src/pages/properties/[id]/index.tsx</files>
  <action>
Verify the complete programs & pricing flow:

1. Start dev server: `cd apps/admin && npm run dev`

2. Test Pricing Settings:
   - Navigate to /settings/pricing
   - Verify all pricing fields load
   - Change a value, verify Save button enables
   - Save and verify toast appears
   - Refresh and verify changes persisted

3. Test Program Builder on property page:
   - Navigate to a property without a program
   - Verify ProgramBuilder displays
   - Select different frequencies, verify pricing updates
   - Select different tiers, verify pricing updates
   - Toggle add-ons, verify pricing updates
   - Set scheduling preferences
   - Click "Activate Program"
   - Verify toast and page updates to show ProgramStatusCard

4. Test Program Status Card:
   - Verify status badge shows correctly
   - Click dropdown, verify all actions present
   - Test Pause - verify status changes
   - Test Resume - verify status changes back
   - Test Cancel - verify dialog appears and works

5. Run build to ensure no errors: `cd apps/admin && npm run build`
  </action>
  <verify>`cd apps/admin && npm run build` succeeds</verify>
  <done>Programs & Pricing feature works end-to-end</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd apps/admin && npm run build` succeeds
- [ ] Pricing Settings page accessible and functional
- [ ] Property page shows ProgramBuilder for new properties
- [ ] Property page shows ProgramStatusCard for properties with programs
- [ ] All lifecycle actions work (pause, resume, cancel)
- [ ] Pricing calculates correctly
</verification>

<success_criteria>
- All tasks completed
- No TypeScript errors
- Phase 4 acceptance criteria met:
  - Program builder displays all frequencies with pricing
  - Program builder displays all tiers with descriptions
  - Add-on checkboxes toggle correctly
  - Pricing calculates and updates in real-time
  - Can save program to database
  - Program status card displays correctly
  - Can pause/resume/cancel program
  - Pricing settings page saves new pricing versions
  - Scheduling preferences save correctly
</success_criteria>

<output>
After completion, create `.planning/phases/04-programs-pricing/04-05-SUMMARY.md`

Update STATE.md with Phase 4 completion status.
Update ROADMAP.md to mark Phase 4 complete.
</output>
