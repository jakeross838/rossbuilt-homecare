---
wave: 1
depends_on: []
files_modified:
  - pages/properties/overview.tsx
  - App.tsx
  - hooks/use-realtime-sync.ts
autonomous: true
---

# Plan 07-01: Admin Properties Overview & Notifications

## Objective

Build admin visibility into all properties with live updates and notification integration for plan changes. This enables admins to monitor all client properties from a single dashboard and receive alerts when clients modify their service plans.

## Prerequisites

- Phase 6 complete (cascade_program_update function exists)
- Realtime sync infrastructure in place
- Notifications table and admin notification insertion via cascade function

## Files Created/Modified

### Created
- `pages/properties/overview.tsx` (280 lines) - Properties overview page with filtering and live updates

### Modified
- `App.tsx` - Added PropertiesOverviewPage import and route at `/properties/overview`
- `hooks/use-realtime-sync.ts` - Added programs and notifications table subscriptions

## Implementation Tasks

### Task 1: Properties Overview Page
**Files:** `pages/properties/overview.tsx`

**Action:**
- Created summary cards showing: total properties, active plans, no-plan count, monthly revenue
- Built filterable table with search, status filter, frequency filter
- Displayed all properties with current plan configuration:
  - Property name and location
  - Client name and company
  - Plan status (active, pending, paused, cancelled)
  - Inspection frequency and tier
  - Add-on indicators (checkmark icons)
  - Monthly cost
- Integrated live updates via `useGlobalRealtimeSync()`
- Added auto-refresh every 30 seconds
- Added manual refresh button with last updated timestamp

**Verify:** Page loads at `/properties/overview`, shows all properties with correct data

**Done:** Admin can view, search, and filter all properties with real-time updates

### Task 2: Realtime Sync Enhancement
**Files:** `hooks/use-realtime-sync.ts`

**Action:**
- Added `programs` table to realtime subscriptions
- Added `notifications` table to realtime subscriptions
- Configured query key invalidation for admin views

**Verify:** Changes to programs trigger UI updates without manual refresh

**Done:** Properties overview updates automatically when plan data changes

### Task 3: Route Integration
**Files:** `App.tsx`

**Action:**
- Added import for PropertiesOverviewPage
- Added route: `<Route path="/properties/overview" element={<PropertiesOverviewPage />} />`

**Verify:** Navigation to `/properties/overview` renders the page correctly

**Done:** Properties overview accessible via direct URL and navigation

## Verification

- Properties overview page loads without errors
- Summary cards display correct aggregate data
- Filter and search functions work correctly
- Realtime updates reflect changes within seconds
- Admin notifications created when clients modify plans (via cascade function)

## Integration with Cascade Function

The notification flow works as follows:
1. Client saves plan changes via Plan Editor
2. Program updated in database
3. `cascade_program_update()` RPC called
4. Notification inserted for admin/manager users
5. Properties overview refreshes (realtime subscription)
6. Admin sees updated plan configuration

## must_haves

- Admin can view all properties with their current features
- Properties table shows add-ons, frequency, tier, monthly cost
- Dashboard updates live when data changes (30s auto-refresh + realtime)
- Admin receives notification when client modifies plan (via cascade function)
- Filtering by status and frequency works
- Search across properties and clients works
