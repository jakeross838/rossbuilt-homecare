---
phase: 01-database-auth
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [supabase/migrations/001_enums.sql, supabase/migrations/002_organizations_users.sql, supabase/migrations/003_clients.sql, supabase/migrations/004_properties.sql]
autonomous: true
user_setup:
  - service: supabase
    why: "Database and authentication backend"
    env_vars:
      - name: NEXT_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard → Project Settings → API → Project URL"
      - name: NEXT_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard → Project Settings → API → anon/public key"
      - name: SUPABASE_SERVICE_ROLE_KEY
        source: "Supabase Dashboard → Project Settings → API → service_role key (keep secret)"
    account_setup:
      - url: "https://supabase.com/dashboard"
        skip_if: "Already have Supabase project for this app"
    dashboard_config:
      - task: "Create new project (if needed)"
        location: "Supabase Dashboard → New Project"
        details: "Name: home-care-os, Region: closest to Florida (us-east-1), Strong password"
---

<objective>
Set up Supabase project and create core database schema including enums, organizations, users, clients, and properties tables.

Purpose: Establish the multi-tenant foundation with SaaS-ready architecture (company_id isolation) for all future entities.
Output: Working Supabase project with core schema, ready for domain tables.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Reference specification:
@~/Downloads/home-care-os-docs/phase-01-database.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize project structure and Supabase configuration</name>
  <files>package.json, supabase/config.toml, .env.local, .gitignore</files>
  <action>
1. Create project root with package.json (name: home-care-os, type: module)
2. Initialize Supabase CLI config: `npx supabase init`
3. Create .env.local with Supabase env vars (placeholders if not provided)
4. Update .gitignore to exclude .env.local, node_modules, .next

If Supabase MCP is available, use it to list/create project. Otherwise, create placeholder env vars and note user needs to fill them in.

Do NOT hardcode any credentials - use environment variables only.
  </action>
  <verify>
- package.json exists with correct name
- supabase/config.toml exists
- .env.local has NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY placeholders
  </verify>
  <done>Project structure ready with Supabase configuration files</done>
</task>

<task type="auto">
  <name>Task 2: Create core schema migrations (Enums + Organizations + Users)</name>
  <files>supabase/migrations/001_enums.sql, supabase/migrations/002_organizations_users.sql</files>
  <action>
Create two migration files:

**001_enums.sql:**
- All enum types from phase-01-database.md:
  - user_role (admin, manager, inspector, client)
  - program_status, inspection_frequency, inspection_tier
  - inspection_status, inspection_item_status
  - recommendation_status, work_order_status, service_request_status
  - invoice_status, priority_level, condition_rating
  - notification_type, calendar_event_type

**002_organizations_users.sql:**
- Enable uuid-ossp and pg_trgm extensions
- organizations table (multi-tenant root with settings JSONB)
- users table (extends auth.users, has organization_id, role, settings)
- Indexes on organization_id, role, email, slug

Follow exact schema from phase-01-database.md. Use UUID primary keys with uuid_generate_v4().
  </action>
  <verify>Files exist with correct SQL syntax (can validate with basic parsing)</verify>
  <done>Enum types and organization/user tables defined in migrations</done>
</task>

<task type="auto">
  <name>Task 3: Create client and property schema migrations</name>
  <files>supabase/migrations/003_clients.sql, supabase/migrations/004_properties.sql</files>
  <action>
**003_clients.sql:**
- clients table with all fields from spec:
  - Primary/secondary contacts
  - Billing address fields
  - stripe_customer_id for payments
  - source, referral_source, tags, notes
  - Proper foreign keys to organizations and users
- Indexes: organization_id, email, user_id, is_active, name (gin trgm)

**004_properties.sql:**
- properties table with all fields:
  - Address with geolocation (latitude/longitude as DECIMAL)
  - Property details (year_built, sqft, beds/baths, construction/roof/foundation)
  - Location info (flood_zone, coastal, gated, HOA)
  - Access codes (gate, garage, lockbox, alarm, wifi)
  - Features JSONB (pool, dock, generator, elevator, etc.)
  - Media fields (photos array, site_plan_url)
- Indexes: organization_id, client_id, location, active, address (gin), features (gin)

Use exact column names and types from phase-01-database.md.
  </action>
  <verify>Files exist with correct foreign key references to prior tables</verify>
  <done>Client and property tables defined with proper relationships</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 4 migration files exist in supabase/migrations/
- [ ] SQL syntax is valid (no obvious errors)
- [ ] Foreign key references chain correctly (users → organizations, clients → organizations, properties → clients)
- [ ] Indexes defined for query optimization
- [ ] .env.local template created
</verification>

<success_criteria>
- Project structure initialized
- 4 migration files created (001-004)
- Environment variable template ready
- Ready to apply migrations in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/01-database-auth/01-01-SUMMARY.md`
</output>
